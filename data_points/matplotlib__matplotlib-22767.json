{
  "repo": "matplotlib/matplotlib",
  "instance_id": "matplotlib__matplotlib-22767",
  "base_commit": "b36ef478bd07be1cf525789696d8d0334d913b67",
  "patch": "diff --git a/lib/matplotlib/contour.py b/lib/matplotlib/contour.py\n--- a/lib/matplotlib/contour.py\n+++ b/lib/matplotlib/contour.py\n@@ -1334,6 +1334,8 @@ def find_nearest_contour(self, x, y, indices=None, pixel=True):\n         \"\"\"\n         Find the point in the contour plot that is closest to ``(x, y)``.\n \n+        This method does not support filled contours.\n+\n         Parameters\n         ----------\n         x, y : float\n@@ -1370,8 +1372,11 @@ def find_nearest_contour(self, x, y, indices=None, pixel=True):\n         # sufficiently well that the time is not noticeable.\n         # Nonetheless, improvements could probably be made.\n \n+        if self.filled:\n+            raise ValueError(\"Method does not support filled contours.\")\n+\n         if indices is None:\n-            indices = range(len(self.levels))\n+            indices = range(len(self.collections))\n \n         d2min = np.inf\n         conmin = None\n",
  "test_patch": "diff --git a/lib/matplotlib/tests/test_contour.py b/lib/matplotlib/tests/test_contour.py\n--- a/lib/matplotlib/tests/test_contour.py\n+++ b/lib/matplotlib/tests/test_contour.py\n@@ -470,6 +470,48 @@ def test_contour_line_start_on_corner_edge():\n     cbar.add_lines(lines)\n \n \n+def test_find_nearest_contour():\n+    xy = np.indices((15, 15))\n+    img = np.exp(-np.pi * (np.sum((xy - 5)**2, 0)/5.**2))\n+    cs = plt.contour(img, 10)\n+\n+    nearest_contour = cs.find_nearest_contour(1, 1, pixel=False)\n+    expected_nearest = (1, 0, 33, 1.965966, 1.965966, 1.866183)\n+    assert_array_almost_equal(nearest_contour, expected_nearest)\n+\n+    nearest_contour = cs.find_nearest_contour(8, 1, pixel=False)\n+    expected_nearest = (1, 0, 5, 7.550173, 1.587542, 0.547550)\n+    assert_array_almost_equal(nearest_contour, expected_nearest)\n+\n+    nearest_contour = cs.find_nearest_contour(2, 5, pixel=False)\n+    expected_nearest = (3, 0, 21, 1.884384, 5.023335, 0.013911)\n+    assert_array_almost_equal(nearest_contour, expected_nearest)\n+\n+    nearest_contour = cs.find_nearest_contour(2, 5,\n+                                              indices=(5, 7),\n+                                              pixel=False)\n+    expected_nearest = (5, 0, 16, 2.628202, 5.0, 0.394638)\n+    assert_array_almost_equal(nearest_contour, expected_nearest)\n+\n+\n+def test_find_nearest_contour_no_filled():\n+    xy = np.indices((15, 15))\n+    img = np.exp(-np.pi * (np.sum((xy - 5)**2, 0)/5.**2))\n+    cs = plt.contourf(img, 10)\n+\n+    with pytest.raises(ValueError,\n+                       match=\"Method does not support filled contours.\"):\n+        cs.find_nearest_contour(1, 1, pixel=False)\n+\n+    with pytest.raises(ValueError,\n+                       match=\"Method does not support filled contours.\"):\n+        cs.find_nearest_contour(1, 10, indices=(5, 7), pixel=False)\n+\n+    with pytest.raises(ValueError,\n+                       match=\"Method does not support filled contours.\"):\n+        cs.find_nearest_contour(2, 5, indices=(2, 7), pixel=True)\n+\n+\n @mpl.style.context(\"default\")\n def test_contour_autolabel_beyond_powerlimits():\n     ax = plt.figure().add_subplot()\n",
  "problem_statement": "[Bug]: Issue with find_nearest_contour in contour.py\n### Bug summary\n\nThe default for the indices keyword in the find_nearest_contour function within countour.py is defined incorrectly in the code.  Line 1377 should be \"indices = range(len(self.layers))\" instead of \"indices = range(len(self.levels)).\"\n\n### Code for reproduction\n\n```python\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\nxy=np.indices((100,100))\r\nimg=np.exp(-np.pi*(np.sum((xy-50)**2,0)/20.**2))\r\ncs=plt.contourf(img,50)\r\ncs.find_nearest_contour(20,20,pixel=False)\n```\n\n\n### Actual outcome\n\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/opt/local/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/matplotlib/contour.py\", line 1388, in find_nearest_contour\r\n    con = self.collections[icon]\r\nIndexError: list index out of range\n\n### Expected outcome\n\n(0, 0, 397, 23.68976612821045, 14.034856810732212, 49.197307349357025)\n\n### Additional information\n\n_No response_\n\n### Operating system\n\nMac OS 12.3.1\n\n### Matplotlib Version\n\n3.5.1\n\n### Matplotlib Backend\n\nTkAgg\n\n### Python version\n\n3.8.12\n\n### Jupyter version\n\n_No response_\n\n### Installation\n\npip\n",
  "hints_text": "@jhelmboldt Would you be willing to open a PR with that change + a test?\nIf @jhelmboldt does not want to open a PR, I can make one later today.\nThanks, @andrew-fennell.  I've never submitted a PR before and don't have time to learn today, so I would appreciate you handling it.  Thank you.",
  "created_at": "2022-04-01T19:11:12Z",
  "version": "3.5",
  "FAIL_TO_PASS": "[\"lib/matplotlib/tests/test_contour.py::test_find_nearest_contour_no_filled\"]",
  "PASS_TO_PASS": "[\"lib/matplotlib/tests/test_contour.py::test_contour_shape_1d_valid\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_2d_valid\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args0-Length\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args1-Length\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args2-Number\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args3-Number\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args4-Shapes\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args5-Shapes\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args6-Inputs\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args7-Input\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args8-Input\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args9-Input\", \"lib/matplotlib/tests/test_contour.py::test_contour_empty_levels\", \"lib/matplotlib/tests/test_contour.py::test_contour_Nlevels\", \"lib/matplotlib/tests/test_contour.py::test_contour_badlevel_fmt\", \"lib/matplotlib/tests/test_contour.py::test_contour_uniform_z\", \"lib/matplotlib/tests/test_contour.py::test_contour_manual_labels[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_manual_labels[pdf]\", \"lib/matplotlib/tests/test_contour.py::test_given_colors_levels_and_extends[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_datetime_axis[png]\", \"lib/matplotlib/tests/test_contour.py::test_labels[png]\", \"lib/matplotlib/tests/test_contour.py::test_corner_mask[png]\", \"lib/matplotlib/tests/test_contour.py::test_contourf_decreasing_levels\", \"lib/matplotlib/tests/test_contour.py::test_contourf_symmetric_locator\", \"lib/matplotlib/tests/test_contour.py::test_internal_cpp_api[args0-TypeError-function\", \"lib/matplotlib/tests/test_contour.py::test_internal_cpp_api[args1-ValueError-Expected\", \"lib/matplotlib/tests/test_contour.py::test_internal_cpp_api[args2-ValueError-x,\", \"lib/matplotlib/tests/test_contour.py::test_internal_cpp_api[args3-ValueError-x,\", \"lib/matplotlib/tests/test_contour.py::test_internal_cpp_api[args4-ValueError-If\", \"lib/matplotlib/tests/test_contour.py::test_internal_cpp_api_2\", \"lib/matplotlib/tests/test_contour.py::test_circular_contour_warning\", \"lib/matplotlib/tests/test_contour.py::test_clabel_zorder[True-123-1234]\", \"lib/matplotlib/tests/test_contour.py::test_clabel_zorder[False-123-1234]\", \"lib/matplotlib/tests/test_contour.py::test_clabel_zorder[True-123-None]\", \"lib/matplotlib/tests/test_contour.py::test_clabel_zorder[False-123-None]\", \"lib/matplotlib/tests/test_contour.py::test_contour_addlines[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_uneven[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_linewidth[1.23-None-None-1.23]\", \"lib/matplotlib/tests/test_contour.py::test_contour_linewidth[1.23-4.24-None-4.24]\", \"lib/matplotlib/tests/test_contour.py::test_contour_linewidth[1.23-4.24-5.02-5.02]\", \"lib/matplotlib/tests/test_contour.py::test_label_nonagg\", \"lib/matplotlib/tests/test_contour.py::test_contour_closed_line_loop[png]\", \"lib/matplotlib/tests/test_contour.py::test_quadcontourset_reuse\", \"lib/matplotlib/tests/test_contour.py::test_contour_manual[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_line_start_on_corner_edge[png]\", \"lib/matplotlib/tests/test_contour.py::test_find_nearest_contour\", \"lib/matplotlib/tests/test_contour.py::test_contour_autolabel_beyond_powerlimits\", \"lib/matplotlib/tests/test_contour.py::test_contourf_legend_elements\", \"lib/matplotlib/tests/test_contour.py::test_contour_legend_elements\"]",
  "environment_setup_commit": "de98877e3dc45de8dd441d008f23d88738dc015d",
  "_download_metadata": {
    "downloaded_at": "2025-10-07T21:23:30.795585",
    "dataset_name": "swe-bench",
    "split": "test",
    "downloader_version": "0.1.0"
  }
}