{
  "repo": "scikit-learn/scikit-learn",
  "instance_id": "scikit-learn__scikit-learn-14878",
  "base_commit": "b02217d8a5651760353e310701e749c1eaece6df",
  "patch": "diff --git a/sklearn/impute/_base.py b/sklearn/impute/_base.py\n--- a/sklearn/impute/_base.py\n+++ b/sklearn/impute/_base.py\n@@ -182,9 +182,9 @@ def _validate_input(self, X):\n                             force_all_finite=force_all_finite, copy=self.copy)\n         except ValueError as ve:\n             if \"could not convert\" in str(ve):\n-                raise ValueError(\"Cannot use {0} strategy with non-numeric \"\n-                                 \"data. Received datatype :{1}.\"\n-                                 \"\".format(self.strategy, X.dtype.kind))\n+                new_ve = ValueError(\"Cannot use {} strategy with non-numeric \"\n+                                    \"data:\\n{}\".format(self.strategy, ve))\n+                raise new_ve from None\n             else:\n                 raise ve\n \n",
  "test_patch": "diff --git a/sklearn/impute/tests/test_impute.py b/sklearn/impute/tests/test_impute.py\n--- a/sklearn/impute/tests/test_impute.py\n+++ b/sklearn/impute/tests/test_impute.py\n@@ -237,8 +237,23 @@ def test_imputation_mean_median_error_invalid_type(strategy, dtype):\n     X = np.array([[\"a\", \"b\", 3],\n                   [4, \"e\", 6],\n                   [\"g\", \"h\", 9]], dtype=dtype)\n+    msg = \"non-numeric data:\\ncould not convert string to float: '\"\n+    with pytest.raises(ValueError, match=msg):\n+        imputer = SimpleImputer(strategy=strategy)\n+        imputer.fit_transform(X)\n \n-    with pytest.raises(ValueError, match=\"non-numeric data\"):\n+\n+@pytest.mark.parametrize(\"strategy\", [\"mean\", \"median\"])\n+@pytest.mark.parametrize(\"type\", ['list', 'dataframe'])\n+def test_imputation_mean_median_error_invalid_type_list_pandas(strategy, type):\n+    X = [[\"a\", \"b\", 3],\n+         [4, \"e\", 6],\n+         [\"g\", \"h\", 9]]\n+    if type == 'dataframe':\n+        pd = pytest.importorskip(\"pandas\")\n+        X = pd.DataFrame(X)\n+    msg = \"non-numeric data:\\ncould not convert string to float: '\"\n+    with pytest.raises(ValueError, match=msg):\n         imputer = SimpleImputer(strategy=strategy)\n         imputer.fit_transform(X)\n \n",
  "problem_statement": "DataFrames not properly validated in SimpleImputer\n```python\r\nimport pandas as pd\r\nfrom sklearn.impute import SimpleImputer\r\n\r\nSimpleImputer().fit(pd.DataFrame({'a': ['b', 'c']}))\r\n```\r\nis not validated correctly:\r\n\r\n```pythontb\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n~/checkout/scikit-learn/sklearn/impute/_base.py in _validate_input(self, X)\r\n    198             X = check_array(X, accept_sparse='csc', dtype=dtype,\r\n--> 199                             force_all_finite=force_all_finite, copy=self.copy)\r\n    200         except ValueError as ve:\r\n\r\n~/checkout/scikit-learn/sklearn/utils/validation.py in check_array(array, accept_sparse, accept_large_sparse, dtype, order, copy, force_all_finite, ensure_2d, allow_nd, ensure_min_samples, ensure_min_features, warn_on_dtype, estimator)\r\n    496                 warnings.simplefilter('error', ComplexWarning)\r\n--> 497                 array = np.asarray(array, dtype=dtype, order=order)\r\n    498             except ComplexWarning:\r\n\r\n~/miniconda3/lib/python3.7/site-packages/numpy/core/numeric.py in asarray(a, dtype, order)\r\n    537     \"\"\"\r\n--> 538     return array(a, dtype, copy=False, order=order)\r\n    539 \r\n\r\nValueError: could not convert string to float: 'b'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nAttributeError                            Traceback (most recent call last)\r\n<ipython-input-6-f08c4f6715ce> in <module>\r\n----> 1 SimpleImputer().fit(pd.DataFrame({'a': ['b', 'c']}))\r\n\r\n~/checkout/scikit-learn/sklearn/impute/_base.py in fit(self, X, y)\r\n    230         self : SimpleImputer\r\n    231         \"\"\"\r\n--> 232         X = self._validate_input(X)\r\n    233 \r\n    234         # default fill_value is 0 for numerical input and \"missing_value\"\r\n\r\n~/checkout/scikit-learn/sklearn/impute/_base.py in _validate_input(self, X)\r\n    202                 raise ValueError(\"Cannot use {0} strategy with non-numeric \"\r\n    203                                  \"data. Received datatype :{1}.\"\r\n--> 204                                  \"\".format(self.strategy, X.dtype.kind))\r\n    205             else:\r\n    206                 raise ve\r\n\r\n~/miniconda3/lib/python3.7/site-packages/pandas/core/generic.py in __getattr__(self, name)\r\n   5065             if self._info_axis._can_hold_identifiers_and_holds_name(name):\r\n   5066                 return self[name]\r\n-> 5067             return object.__getattribute__(self, name)\r\n   5068 \r\n   5069     def __setattr__(self, name, value):\r\n\r\nAttributeError: 'DataFrame' object has no attribute 'dtype'\r\n```\r\n\n",
  "hints_text": "",
  "created_at": "2019-09-03T22:39:43Z",
  "version": "0.22",
  "FAIL_TO_PASS": "[\"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type[None-mean]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type[None-median]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type[object-mean]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type[object-median]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type[str-mean]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type[str-median]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type_list_pandas[list-mean]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type_list_pandas[list-median]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type_list_pandas[dataframe-mean]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median_error_invalid_type_list_pandas[dataframe-median]\"]",
  "PASS_TO_PASS": "[\"sklearn/impute/tests/test_impute.py::test_imputation_shape[mean]\", \"sklearn/impute/tests/test_impute.py::test_imputation_shape[median]\", \"sklearn/impute/tests/test_impute.py::test_imputation_shape[most_frequent]\", \"sklearn/impute/tests/test_impute.py::test_imputation_shape[constant]\", \"sklearn/impute/tests/test_impute.py::test_imputation_error_invalid_strategy[const]\", \"sklearn/impute/tests/test_impute.py::test_imputation_error_invalid_strategy[101]\", \"sklearn/impute/tests/test_impute.py::test_imputation_error_invalid_strategy[None]\", \"sklearn/impute/tests/test_impute.py::test_imputation_deletion_warning[mean]\", \"sklearn/impute/tests/test_impute.py::test_imputation_deletion_warning[median]\", \"sklearn/impute/tests/test_impute.py::test_imputation_deletion_warning[most_frequent]\", \"sklearn/impute/tests/test_impute.py::test_imputation_error_sparse_0[mean]\", \"sklearn/impute/tests/test_impute.py::test_imputation_error_sparse_0[median]\", \"sklearn/impute/tests/test_impute.py::test_imputation_error_sparse_0[most_frequent]\", \"sklearn/impute/tests/test_impute.py::test_imputation_error_sparse_0[constant]\", \"sklearn/impute/tests/test_impute.py::test_imputation_mean_median\", \"sklearn/impute/tests/test_impute.py::test_imputation_median_special_cases\", \"sklearn/impute/tests/test_impute.py::test_imputation_const_mostf_error_invalid_types[str-constant]\", \"sklearn/impute/tests/test_impute.py::test_imputation_const_mostf_error_invalid_types[str-most_frequent]\", \"sklearn/impute/tests/test_impute.py::test_imputation_const_mostf_error_invalid_types[dtype1-constant]\", \"sklearn/impute/tests/test_impute.py::test_imputation_const_mostf_error_invalid_types[dtype1-most_frequent]\", \"sklearn/impute/tests/test_impute.py::test_imputation_const_mostf_error_invalid_types[dtype2-constant]\", \"sklearn/impute/tests/test_impute.py::test_imputation_const_mostf_error_invalid_types[dtype2-most_frequent]\", \"sklearn/impute/tests/test_impute.py::test_imputation_most_frequent\", \"sklearn/impute/tests/test_impute.py::test_imputation_most_frequent_objects[None]\", \"sklearn/impute/tests/test_impute.py::test_imputation_most_frequent_objects[nan]\", \"sklearn/impute/tests/test_impute.py::test_imputation_most_frequent_objects[NAN]\", \"sklearn/impute/tests/test_impute.py::test_imputation_most_frequent_objects[]\", \"sklearn/impute/tests/test_impute.py::test_imputation_most_frequent_objects[0]\", \"sklearn/impute/tests/test_impute.py::test_imputation_most_frequent_pandas[object]\", \"sklearn/impute/tests/test_impute.py::test_imputation_most_frequent_pandas[category]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_error_invalid_type[1-0]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_error_invalid_type[1.0-nan]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_integer\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_float[csr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_float[asarray]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_object[None]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_object[nan]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_object[NAN]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_object[]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_object[0]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_pandas[object]\", \"sklearn/impute/tests/test_impute.py::test_imputation_constant_pandas[category]\", \"sklearn/impute/tests/test_impute.py::test_imputation_missing_value_in_test_array[SimpleImputer]\", \"sklearn/impute/tests/test_impute.py::test_imputation_missing_value_in_test_array[IterativeImputer]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_one_feature[X0]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_one_feature[X1]\", \"sklearn/impute/tests/test_impute.py::test_imputation_pipeline_grid_search\", \"sklearn/impute/tests/test_impute.py::test_imputation_copy\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_zero_iters\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_verbose\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_all_missing\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_imputation_order[random]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_imputation_order[roman]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_imputation_order[ascending]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_imputation_order[descending]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_imputation_order[arabic]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_estimators[None]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_estimators[estimator1]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_estimators[estimator2]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_estimators[estimator3]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_estimators[estimator4]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_clip\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_clip_truncnorm\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_truncated_normal_posterior\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_missing_at_transform[mean]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_missing_at_transform[median]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_missing_at_transform[most_frequent]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_transform_stochasticity\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_no_missing\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_rank_one\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_transform_recovery[3]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_transform_recovery[5]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_additive_matrix\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_error_param[-1-0.001-ValueError-should\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_error_param[1--0.001-ValueError-should\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_early_stopping\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_catch_warning\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_skip_non_missing[True]\", \"sklearn/impute/tests/test_impute.py::test_iterative_imputer_skip_non_missing[False]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_error[X_fit0-X_trans0-params0-have\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_error[X_fit1-X_trans1-params1-'features'\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_error[X_fit2-X_trans2-params2-'sparse'\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_error[X_fit3-X_trans3-params3-MissingIndicator\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0-nan-float64-array]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0-0-int32-array]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0--1-int32-array]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0-nan-float64-csc_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0--1-int32-csc_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0-nan-float64-csr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0--1-int32-csr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0-nan-float64-coo_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0--1-int32-coo_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0-nan-float64-lil_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0--1-int32-lil_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0-nan-float64-bsr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[missing-only-3-features_indices0--1-int32-bsr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1-nan-float64-array]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1-0-int32-array]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1--1-int32-array]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1-nan-float64-csc_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1--1-int32-csc_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1-nan-float64-csr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1--1-int32-csr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1-nan-float64-coo_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1--1-int32-coo_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1-nan-float64-lil_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1--1-int32-lil_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1-nan-float64-bsr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_new[all-3-features_indices1--1-int32-bsr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_raise_on_sparse_with_missing_0[csc_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_raise_on_sparse_with_missing_0[csr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_raise_on_sparse_with_missing_0[coo_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_raise_on_sparse_with_missing_0[lil_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_raise_on_sparse_with_missing_0[bsr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-array-True]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-array-False]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-array-auto]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[0-array-True]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[0-array-False]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[0-array-auto]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-csc_matrix-True]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-csc_matrix-False]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-csc_matrix-auto]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-csr_matrix-True]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-csr_matrix-False]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-csr_matrix-auto]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-coo_matrix-True]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-coo_matrix-False]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-coo_matrix-auto]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-lil_matrix-True]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-lil_matrix-False]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_param[nan-lil_matrix-auto]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_string\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_with_imputer[X0-a-X_trans_exp0]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_with_imputer[X1-nan-X_trans_exp1]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_with_imputer[X2-nan-X_trans_exp2]\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_with_imputer[X3-None-X_trans_exp3]\", \"sklearn/impute/tests/test_impute.py::test_inconsistent_dtype_X_missing_values[NaN-nan-Input\", \"sklearn/impute/tests/test_impute.py::test_inconsistent_dtype_X_missing_values[-1--1-types\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_no_missing\", \"sklearn/impute/tests/test_impute.py::test_missing_indicator_sparse_no_explicit_zeros\", \"sklearn/impute/tests/test_impute.py::test_imputers_add_indicator[SimpleImputer-nan]\", \"sklearn/impute/tests/test_impute.py::test_imputers_add_indicator[SimpleImputer--1]\", \"sklearn/impute/tests/test_impute.py::test_imputers_add_indicator[SimpleImputer-0]\", \"sklearn/impute/tests/test_impute.py::test_imputers_add_indicator[IterativeImputer-nan]\", \"sklearn/impute/tests/test_impute.py::test_imputers_add_indicator[IterativeImputer--1]\", \"sklearn/impute/tests/test_impute.py::test_imputers_add_indicator[IterativeImputer-0]\", \"sklearn/impute/tests/test_impute.py::test_imputer_without_indicator[SimpleImputer]\", \"sklearn/impute/tests/test_impute.py::test_imputer_without_indicator[IterativeImputer]\", \"sklearn/impute/tests/test_impute.py::test_simple_imputation_add_indicator_sparse_matrix[csc_matrix]\", \"sklearn/impute/tests/test_impute.py::test_simple_imputation_add_indicator_sparse_matrix[csr_matrix]\", \"sklearn/impute/tests/test_impute.py::test_simple_imputation_add_indicator_sparse_matrix[coo_matrix]\", \"sklearn/impute/tests/test_impute.py::test_simple_imputation_add_indicator_sparse_matrix[lil_matrix]\", \"sklearn/impute/tests/test_impute.py::test_simple_imputation_add_indicator_sparse_matrix[bsr_matrix]\"]",
  "environment_setup_commit": "7e85a6d1f038bbb932b36f18d75df6be937ed00d",
  "_download_metadata": {
    "downloaded_at": "2025-10-07T21:23:31.008544",
    "dataset_name": "swe-bench",
    "split": "test",
    "downloader_version": "0.1.0"
  }
}