{
  "repo": "matplotlib/matplotlib",
  "instance_id": "matplotlib__matplotlib-23266",
  "base_commit": "dab648ac5eff66a39742f718a356ebe250e01880",
  "patch": "diff --git a/lib/matplotlib/contour.py b/lib/matplotlib/contour.py\n--- a/lib/matplotlib/contour.py\n+++ b/lib/matplotlib/contour.py\n@@ -701,7 +701,7 @@ def __init__(self, ax, *args,\n                  hatches=(None,), alpha=None, origin=None, extent=None,\n                  cmap=None, colors=None, norm=None, vmin=None, vmax=None,\n                  extend='neither', antialiased=None, nchunk=0, locator=None,\n-                 transform=None,\n+                 transform=None, negative_linestyles=None,\n                  **kwargs):\n         \"\"\"\n         Draw contour lines or filled regions, depending on\n@@ -786,6 +786,13 @@ def __init__(self, ax, *args,\n \n         self._transform = transform\n \n+        self.negative_linestyles = negative_linestyles\n+        # If negative_linestyles was not defined as a kwarg,\n+        # define negative_linestyles with rcParams\n+        if self.negative_linestyles is None:\n+            self.negative_linestyles = \\\n+                mpl.rcParams['contour.negative_linestyle']\n+\n         kwargs = self._process_args(*args, **kwargs)\n         self._process_levels()\n \n@@ -1276,11 +1283,10 @@ def _process_linestyles(self):\n         if linestyles is None:\n             tlinestyles = ['solid'] * Nlev\n             if self.monochrome:\n-                neg_ls = mpl.rcParams['contour.negative_linestyle']\n                 eps = - (self.zmax - self.zmin) * 1e-15\n                 for i, lev in enumerate(self.levels):\n                     if lev < eps:\n-                        tlinestyles[i] = neg_ls\n+                        tlinestyles[i] = self.negative_linestyles\n         else:\n             if isinstance(linestyles, str):\n                 tlinestyles = [linestyles] * Nlev\n@@ -1751,6 +1757,18 @@ def _initialize_x_y(self, z):\n     iterable is shorter than the number of contour levels\n     it will be repeated as necessary.\n \n+negative_linestyles : {*None*, 'solid', 'dashed', 'dashdot', 'dotted'}, \\\n+                       optional\n+    *Only applies to* `.contour`.\n+\n+    If *negative_linestyles* is None, the default is 'dashed' for\n+    negative contours.\n+\n+    *negative_linestyles* can also be an iterable of the above\n+    strings specifying a set of linestyles to be used. If this\n+    iterable is shorter than the number of contour levels\n+    it will be repeated as necessary.\n+\n hatches : list[str], optional\n     *Only applies to* `.contourf`.\n \n",
  "test_patch": "diff --git a/lib/matplotlib/tests/test_contour.py b/lib/matplotlib/tests/test_contour.py\n--- a/lib/matplotlib/tests/test_contour.py\n+++ b/lib/matplotlib/tests/test_contour.py\n@@ -605,3 +605,80 @@ def test_subfigure_clabel():\n         CS = ax.contour(X, Y, Z)\n         ax.clabel(CS, inline=True, fontsize=10)\n         ax.set_title(\"Simplest default with labels\")\n+\n+\n+@pytest.mark.parametrize(\n+    \"style\", ['solid', 'dashed', 'dashdot', 'dotted'])\n+def test_linestyles(style):\n+    delta = 0.025\n+    x = np.arange(-3.0, 3.0, delta)\n+    y = np.arange(-2.0, 2.0, delta)\n+    X, Y = np.meshgrid(x, y)\n+    Z1 = np.exp(-X**2 - Y**2)\n+    Z2 = np.exp(-(X - 1)**2 - (Y - 1)**2)\n+    Z = (Z1 - Z2) * 2\n+\n+    # Positive contour defaults to solid\n+    fig1, ax1 = plt.subplots()\n+    CS1 = ax1.contour(X, Y, Z, 6, colors='k')\n+    ax1.clabel(CS1, fontsize=9, inline=True)\n+    ax1.set_title('Single color - positive contours solid (default)')\n+    assert CS1.linestyles is None  # default\n+\n+    # Change linestyles using linestyles kwarg\n+    fig2, ax2 = plt.subplots()\n+    CS2 = ax2.contour(X, Y, Z, 6, colors='k', linestyles=style)\n+    ax2.clabel(CS2, fontsize=9, inline=True)\n+    ax2.set_title(f'Single color - positive contours {style}')\n+    assert CS2.linestyles == style\n+\n+    # Ensure linestyles do not change when negative_linestyles is defined\n+    fig3, ax3 = plt.subplots()\n+    CS3 = ax3.contour(X, Y, Z, 6, colors='k', linestyles=style,\n+                      negative_linestyles='dashdot')\n+    ax3.clabel(CS3, fontsize=9, inline=True)\n+    ax3.set_title(f'Single color - positive contours {style}')\n+    assert CS3.linestyles == style\n+\n+\n+@pytest.mark.parametrize(\n+    \"style\", ['solid', 'dashed', 'dashdot', 'dotted'])\n+def test_negative_linestyles(style):\n+    delta = 0.025\n+    x = np.arange(-3.0, 3.0, delta)\n+    y = np.arange(-2.0, 2.0, delta)\n+    X, Y = np.meshgrid(x, y)\n+    Z1 = np.exp(-X**2 - Y**2)\n+    Z2 = np.exp(-(X - 1)**2 - (Y - 1)**2)\n+    Z = (Z1 - Z2) * 2\n+\n+    # Negative contour defaults to dashed\n+    fig1, ax1 = plt.subplots()\n+    CS1 = ax1.contour(X, Y, Z, 6, colors='k')\n+    ax1.clabel(CS1, fontsize=9, inline=True)\n+    ax1.set_title('Single color - negative contours dashed (default)')\n+    assert CS1.negative_linestyles == 'dashed'  # default\n+\n+    # Change negative_linestyles using rcParams\n+    plt.rcParams['contour.negative_linestyle'] = style\n+    fig2, ax2 = plt.subplots()\n+    CS2 = ax2.contour(X, Y, Z, 6, colors='k')\n+    ax2.clabel(CS2, fontsize=9, inline=True)\n+    ax2.set_title(f'Single color - negative contours {style}'\n+                   '(using rcParams)')\n+    assert CS2.negative_linestyles == style\n+\n+    # Change negative_linestyles using negative_linestyles kwarg\n+    fig3, ax3 = plt.subplots()\n+    CS3 = ax3.contour(X, Y, Z, 6, colors='k', negative_linestyles=style)\n+    ax3.clabel(CS3, fontsize=9, inline=True)\n+    ax3.set_title(f'Single color - negative contours {style}')\n+    assert CS3.negative_linestyles == style\n+\n+    # Ensure negative_linestyles do not change when linestyles is defined\n+    fig4, ax4 = plt.subplots()\n+    CS4 = ax4.contour(X, Y, Z, 6, colors='k', linestyles='dashdot',\n+                      negative_linestyles=style)\n+    ax4.clabel(CS4, fontsize=9, inline=True)\n+    ax4.set_title(f'Single color - negative contours {style}')\n+    assert CS4.negative_linestyles == style\n",
  "problem_statement": "[ENH]: contour kwarg for negative_linestyle\n### Problem\n\nif you contour a negative quantity, it gets dashed lines.  Leaving aside whether this is a good default or not, the only way to toggle this is via `rcParams['contour.negative_linestyle']=False`.  \r\n\n\n### Proposed solution\n\n\r\nI think this should be togglable via kwarg, though I appreciate that overlaps with `linestyle` and only is activated with monochrome contours.  \r\n\r\n(I actually think the default should be False, FWIW - this surprises me every time, and I make quite a few contour plots).  \n",
  "hints_text": "Should the current `linestyles` kwarg be used to accomplish this or should a new kwarg be added? I have a simple solution adding a new kwarg (though it would need a little more work before it is ready).\r\n\r\nThe following code snippet and images will show a solution with an added kwarg, but I expect this is not exactly what you had in mind.\r\n\r\n\r\n```\r\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\n\r\ndelta = 0.025\r\nx = np.arange(-3.0, 3.0, delta)\r\ny = np.arange(-2.0, 2.0, delta)\r\nX, Y = np.meshgrid(x, y)\r\nZ1 = np.exp(-X**2 - Y**2)\r\nZ2 = np.exp(-(X - 1)**2 - (Y - 1)**2)\r\nZ = (Z1 - Z2) * 2\r\n\r\n# Negative contour defaults to dashed\r\nfig, ax = plt.subplots()\r\nCS = ax.contour(X, Y, Z, 6, colors='k')\r\nax.clabel(CS, fontsize=9, inline=True)\r\nax.set_title('Single color - negative contours dashed (default)')\r\n\r\n# Set negative contours to be solid instead of dashed (default)\r\n# using negative_linestyle='solid'\r\nfig2, ax2 = plt.subplots()\r\nCS = ax2.contour(X, Y, Z, 6, colors='k', negative_linestyles='solid')\r\nax2.clabel(CS, fontsize=9, inline=True)\r\nax2.set_title('Single color - negative contours solid')\r\n```\r\n\r\n### Default\r\n![image](https://user-images.githubusercontent.com/28690153/168208633-7e0ca845-e218-445c-a19a-850f279a15ec.png)\r\n\r\n### `negative_linestyles='solid'`\r\n![image](https://user-images.githubusercontent.com/28690153/168208620-88c3a5eb-7bb4-4f6a-8890-b23c76a30928.png)\n> Should the current `linestyles` kwarg be used to accomplish this or should a new kwarg be added?\r\n\r\nHow would we squeeze this into the current `linestyles` parameter? The only thing I could imagine is something like `linestyles={'positive': 'solid', 'negative': 'dotted'}`, which I find a bit cumbersome. I suppose an extra kwarg is simpler.\n> How would we squeeze this into the current linestyles parameter?\n\nI had no good solution for this either, but thought I would ask just in case.\n\nThe next question is: \n1. should this be a boolean (the rcParams method seems to be)\n2. or should the kwarg accept a separate entry for negative linestyles?\n\nI think the latter makes a lot more sense, but I don't work with contour plots regularly.\nI think since the rcParam is separate, its fine to keep the (potential) kwarg separate.  BTW I'm not wedded to this idea, but it does seem strange to have a feature only accessible by rcParam.  \r\n\r\nAs for bool vs string, I'd say both?   right now the rcParam defaults to \"dashed\" - I think that's fine for a kwarg as well, but being able to say *False* to skip the behaviour would be nice as well.  \n> BTW I'm not wedded to this idea\r\n\r\nI can mock-up a basic solution. Maybe we can get opinions from other contributors and maintainers in the meantime.\r\n\r\nI think this would add value because it would make customization of negative contours more straightforward. Since this doesn't require removing any current functionality, I don't see any cons to adding the kwarg.",
  "created_at": "2022-06-14T04:56:38Z",
  "version": "3.5",
  "FAIL_TO_PASS": "[\"lib/matplotlib/tests/test_contour.py::test_linestyles[solid]\", \"lib/matplotlib/tests/test_contour.py::test_linestyles[dashed]\", \"lib/matplotlib/tests/test_contour.py::test_linestyles[dashdot]\", \"lib/matplotlib/tests/test_contour.py::test_linestyles[dotted]\", \"lib/matplotlib/tests/test_contour.py::test_negative_linestyles[solid]\", \"lib/matplotlib/tests/test_contour.py::test_negative_linestyles[dashed]\", \"lib/matplotlib/tests/test_contour.py::test_negative_linestyles[dashdot]\", \"lib/matplotlib/tests/test_contour.py::test_negative_linestyles[dotted]\"]",
  "PASS_TO_PASS": "[\"lib/matplotlib/tests/test_contour.py::test_contour_shape_1d_valid\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_2d_valid\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args0-Length\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args1-Length\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args2-Number\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args3-Number\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args4-Shapes\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args5-Shapes\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args6-Inputs\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args7-Input\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args8-Input\", \"lib/matplotlib/tests/test_contour.py::test_contour_shape_error[args9-Input\", \"lib/matplotlib/tests/test_contour.py::test_contour_empty_levels\", \"lib/matplotlib/tests/test_contour.py::test_contour_Nlevels\", \"lib/matplotlib/tests/test_contour.py::test_contour_badlevel_fmt\", \"lib/matplotlib/tests/test_contour.py::test_contour_uniform_z\", \"lib/matplotlib/tests/test_contour.py::test_contour_manual_labels[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_manual_labels[pdf]\", \"lib/matplotlib/tests/test_contour.py::test_given_colors_levels_and_extends[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_datetime_axis[png]\", \"lib/matplotlib/tests/test_contour.py::test_labels[png]\", \"lib/matplotlib/tests/test_contour.py::test_corner_mask[png]\", \"lib/matplotlib/tests/test_contour.py::test_contourf_decreasing_levels\", \"lib/matplotlib/tests/test_contour.py::test_contourf_symmetric_locator\", \"lib/matplotlib/tests/test_contour.py::test_circular_contour_warning\", \"lib/matplotlib/tests/test_contour.py::test_clabel_zorder[True-123-1234]\", \"lib/matplotlib/tests/test_contour.py::test_clabel_zorder[False-123-1234]\", \"lib/matplotlib/tests/test_contour.py::test_clabel_zorder[True-123-None]\", \"lib/matplotlib/tests/test_contour.py::test_clabel_zorder[False-123-None]\", \"lib/matplotlib/tests/test_contour.py::test_contour_addlines[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_uneven[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_linewidth[1.23-None-None-1.23]\", \"lib/matplotlib/tests/test_contour.py::test_contour_linewidth[1.23-4.24-None-4.24]\", \"lib/matplotlib/tests/test_contour.py::test_contour_linewidth[1.23-4.24-5.02-5.02]\", \"lib/matplotlib/tests/test_contour.py::test_label_nonagg\", \"lib/matplotlib/tests/test_contour.py::test_contour_closed_line_loop[png]\", \"lib/matplotlib/tests/test_contour.py::test_quadcontourset_reuse\", \"lib/matplotlib/tests/test_contour.py::test_contour_manual[png]\", \"lib/matplotlib/tests/test_contour.py::test_contour_line_start_on_corner_edge[png]\", \"lib/matplotlib/tests/test_contour.py::test_find_nearest_contour\", \"lib/matplotlib/tests/test_contour.py::test_find_nearest_contour_no_filled\", \"lib/matplotlib/tests/test_contour.py::test_contour_autolabel_beyond_powerlimits\", \"lib/matplotlib/tests/test_contour.py::test_contourf_legend_elements\", \"lib/matplotlib/tests/test_contour.py::test_contour_legend_elements\", \"lib/matplotlib/tests/test_contour.py::test_algorithm_name[mpl2005-Mpl2005ContourGenerator]\", \"lib/matplotlib/tests/test_contour.py::test_algorithm_name[mpl2014-Mpl2014ContourGenerator]\", \"lib/matplotlib/tests/test_contour.py::test_algorithm_name[serial-SerialContourGenerator]\", \"lib/matplotlib/tests/test_contour.py::test_algorithm_name[threaded-ThreadedContourGenerator]\", \"lib/matplotlib/tests/test_contour.py::test_algorithm_name[invalid-None]\", \"lib/matplotlib/tests/test_contour.py::test_algorithm_supports_corner_mask[mpl2005]\", \"lib/matplotlib/tests/test_contour.py::test_algorithm_supports_corner_mask[mpl2014]\", \"lib/matplotlib/tests/test_contour.py::test_algorithm_supports_corner_mask[serial]\", \"lib/matplotlib/tests/test_contour.py::test_algorithm_supports_corner_mask[threaded]\", \"lib/matplotlib/tests/test_contour.py::test_all_algorithms[png]\", \"lib/matplotlib/tests/test_contour.py::test_subfigure_clabel\"]",
  "environment_setup_commit": "de98877e3dc45de8dd441d008f23d88738dc015d",
  "_download_metadata": {
    "downloaded_at": "2025-10-07T21:23:30.801347",
    "dataset_name": "swe-bench",
    "split": "test",
    "downloader_version": "0.1.0"
  }
}