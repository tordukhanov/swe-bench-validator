{
  "repo": "matplotlib/matplotlib",
  "instance_id": "matplotlib__matplotlib-24924",
  "base_commit": "5a87d37835693ccc6579938d4948cf91a974a23b",
  "patch": "diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py\n--- a/lib/matplotlib/figure.py\n+++ b/lib/matplotlib/figure.py\n@@ -2760,9 +2760,9 @@ def set_tight_layout(self, tight):\n         \"\"\"\n         if tight is None:\n             tight = mpl.rcParams['figure.autolayout']\n+        _tight = 'tight' if bool(tight) else 'none'\n         _tight_parameters = tight if isinstance(tight, dict) else {}\n-        if bool(tight):\n-            self.set_layout_engine(TightLayoutEngine(**_tight_parameters))\n+        self.set_layout_engine(_tight, **_tight_parameters)\n         self.stale = True\n \n     def get_constrained_layout(self):\n@@ -2797,10 +2797,9 @@ def set_constrained_layout(self, constrained):\n         \"\"\"\n         if constrained is None:\n             constrained = mpl.rcParams['figure.constrained_layout.use']\n-        _constrained = bool(constrained)\n+        _constrained = 'constrained' if bool(constrained) else 'none'\n         _parameters = constrained if isinstance(constrained, dict) else {}\n-        if _constrained:\n-            self.set_layout_engine(ConstrainedLayoutEngine(**_parameters))\n+        self.set_layout_engine(_constrained, **_parameters)\n         self.stale = True\n \n     @_api.deprecated(\n",
  "test_patch": "diff --git a/lib/matplotlib/tests/test_constrainedlayout.py b/lib/matplotlib/tests/test_constrainedlayout.py\n--- a/lib/matplotlib/tests/test_constrainedlayout.py\n+++ b/lib/matplotlib/tests/test_constrainedlayout.py\n@@ -667,3 +667,14 @@ def test_compressed1():\n def test_set_constrained_layout(arg, state):\n     fig, ax = plt.subplots(constrained_layout=arg)\n     assert fig.get_constrained_layout() is state\n+\n+\n+def test_constrained_toggle():\n+    fig, ax = plt.subplots()\n+    with pytest.warns(PendingDeprecationWarning):\n+        fig.set_constrained_layout(True)\n+        assert fig.get_constrained_layout()\n+        fig.set_constrained_layout(False)\n+        assert not fig.get_constrained_layout()\n+        fig.set_constrained_layout(True)\n+        assert fig.get_constrained_layout()\ndiff --git a/lib/matplotlib/tests/test_tightlayout.py b/lib/matplotlib/tests/test_tightlayout.py\n--- a/lib/matplotlib/tests/test_tightlayout.py\n+++ b/lib/matplotlib/tests/test_tightlayout.py\n@@ -380,3 +380,14 @@ def test_tight_pads():\n def test_tight_kwargs():\n     fig, ax = plt.subplots(tight_layout={'pad': 0.15})\n     fig.draw_without_rendering()\n+\n+\n+def test_tight_toggle():\n+    fig, ax = plt.subplots()\n+    with pytest.warns(PendingDeprecationWarning):\n+        fig.set_tight_layout(True)\n+        assert fig.get_tight_layout()\n+        fig.set_tight_layout(False)\n+        assert not fig.get_tight_layout()\n+        fig.set_tight_layout(True)\n+        assert fig.get_tight_layout()\n",
  "problem_statement": "[Bug]: Cannot toggle set_tight_layout\n### Bug summary\r\n\r\nAs of #20426 calling `Figure.set_tight_layout(False)` does not disable the tight layout algorithm. \r\n\r\n### Code for reproduction\r\n\r\n```python\r\nfrom matplotlib import pyplot as plt\r\n\r\nfig, ax = plt.subplots()\r\nfig.set_tight_layout(True)\r\nfig.set_tight_layout(False)\r\nassert not fig.get_tight_layout()\r\n```\r\n\r\n\r\n### Actual outcome\r\n\r\nAssertionError\r\n\r\n### Expected outcome\r\n\r\nclean exit\r\n\r\n### Additional information\r\n\r\nI'm pretty sure [this branch](https://github.com/matplotlib/matplotlib/blob/88371856684ee5ca12a04a084354d8592e49386e/lib/matplotlib/figure.py#L2502-L2503) just needs to set `self.set_layout_engine(None)` in the falsey case.  Attn: @jklymak \r\n\r\n### Operating system\r\n\r\n_No response_\r\n\r\n### Matplotlib Version\r\n\r\nmain\r\n\r\n### Matplotlib Backend\r\n\r\n_No response_\r\n\r\n### Python version\r\n\r\n_No response_\r\n\r\n### Jupyter version\r\n\r\n_No response_\r\n\r\n### Installation\r\n\r\n_No response_\n",
  "hints_text": "",
  "created_at": "2023-01-10T07:28:52Z",
  "version": "3.6",
  "FAIL_TO_PASS": "[\"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_toggle\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_toggle\"]",
  "PASS_TO_PASS": "[\"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout1[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout2[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout3[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout4[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout5[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout6[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_identical_subgridspec\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout7\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout8[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout9[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout10[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout11[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout11rat[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout12[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout13[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout14[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout15[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout16[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout17[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout18\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout19\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout20\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout21\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout22\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_constrained_layout23\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_colorbar_location[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_hidden_axes\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_colorbar_align\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_colorbars_no_overlapV[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_colorbars_no_overlapH[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_manually_set_position\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_bboxtight[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_bbox[png]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_align_labels\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_suplabels\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_gridspec_addressing\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_discouraged_api\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_kwargs\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_rect\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_set_constrained_layout[True-True]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_set_constrained_layout[False-False]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_set_constrained_layout[arg2-True]\", \"lib/matplotlib/tests/test_constrainedlayout.py::test_set_constrained_layout[arg3-True]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout1[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout1[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout2[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout2[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout3[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout3[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout4[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout4[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout5[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout5[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout6[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout6[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout7[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout7[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout8[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout8[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout9[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout9[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_outward_ticks\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout_offsetboxes[png]\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_layout_offsetboxes[pdf]\", \"lib/matplotlib/tests/test_tightlayout.py::test_empty_layout\", \"lib/matplotlib/tests/test_tightlayout.py::test_verybig_decorators[xlabel]\", \"lib/matplotlib/tests/test_tightlayout.py::test_verybig_decorators[ylabel]\", \"lib/matplotlib/tests/test_tightlayout.py::test_big_decorators_horizontal\", \"lib/matplotlib/tests/test_tightlayout.py::test_big_decorators_vertical\", \"lib/matplotlib/tests/test_tightlayout.py::test_badsubplotgrid\", \"lib/matplotlib/tests/test_tightlayout.py::test_collapsed\", \"lib/matplotlib/tests/test_tightlayout.py::test_suptitle\", \"lib/matplotlib/tests/test_tightlayout.py::test_non_agg_renderer\", \"lib/matplotlib/tests/test_tightlayout.py::test_manual_colorbar\", \"lib/matplotlib/tests/test_tightlayout.py::test_clipped_to_axes\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_pads\", \"lib/matplotlib/tests/test_tightlayout.py::test_tight_kwargs\"]",
  "environment_setup_commit": "73909bcb408886a22e2b84581d6b9e6d9907c813",
  "_download_metadata": {
    "downloaded_at": "2025-10-07T21:23:30.815621",
    "dataset_name": "swe-bench",
    "split": "test",
    "downloader_version": "0.1.0"
  }
}