{
  "repo": "sympy/sympy",
  "instance_id": "sympy__sympy-18903",
  "base_commit": "0d77d28d1be6758d8d921068c7d54e32befe11b3",
  "patch": "diff --git a/sympy/functions/elementary/integers.py b/sympy/functions/elementary/integers.py\n--- a/sympy/functions/elementary/integers.py\n+++ b/sympy/functions/elementary/integers.py\n@@ -68,6 +68,8 @@ def eval(cls, arg):\n             return ipart\n         elif spart.is_imaginary or (S.ImaginaryUnit*spart).is_real:\n             return ipart + cls(im(spart), evaluate=False)*S.ImaginaryUnit\n+        elif isinstance(spart, (floor, ceiling)):\n+            return ipart + spart\n         else:\n             return ipart + cls(spart, evaluate=False)\n \n",
  "test_patch": "diff --git a/sympy/functions/elementary/tests/test_integers.py b/sympy/functions/elementary/tests/test_integers.py\n--- a/sympy/functions/elementary/tests/test_integers.py\n+++ b/sympy/functions/elementary/tests/test_integers.py\n@@ -561,6 +561,10 @@ def test_nested_floor_ceiling():\n     assert floor(ceiling(-floor(x**Rational(7, 2)/y))) == -floor(x**Rational(7, 2)/y)\n     assert -ceiling(-ceiling(floor(x)/y)) == ceiling(floor(x)/y)\n \n+def test_issue_18689():\n+    assert floor(floor(floor(x)) + 3) == floor(x) + 3\n+    assert ceiling(ceiling(ceiling(x)) + 1) == ceiling(x) + 1\n+    assert ceiling(ceiling(floor(x)) + 3) == floor(x) + 3\n \n def test_issue_18421():\n     assert floor(float(0)) is S.Zero\n",
  "problem_statement": "Nested floor and ceiling don't fully evaluate\n```\r\n>>> floor(floor(x) + 1) + x\r\nx + floor(floor(x)) + 1\r\n>>> x + floor(floor(x)) + 1\r\nx + floor(x) + 1\r\n```\r\n\r\nSame idea with `ceiling`.\n",
  "hints_text": "For me `floor(floor(x))` does evaluate. The problem is the logic for stipping off 1 happens after that. \nit seems #18689 is logically correct. it's not an issue.",
  "created_at": "2020-03-18T18:14:51Z",
  "version": "1.6",
  "FAIL_TO_PASS": "[\"test_issue_18689\"]",
  "PASS_TO_PASS": "[\"test_floor\", \"test_ceiling\", \"test_frac\", \"test_series\", \"test_issue_11207\", \"test_nested_floor_ceiling\"]",
  "environment_setup_commit": "28b41c73c12b70d6ad9f6e45109a80649c4456da",
  "_download_metadata": {
    "downloaded_at": "2025-10-07T21:23:31.128389",
    "dataset_name": "swe-bench",
    "split": "test",
    "downloader_version": "0.1.0"
  }
}