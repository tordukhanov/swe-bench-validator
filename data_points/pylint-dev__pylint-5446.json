{
  "repo": "pylint-dev/pylint",
  "instance_id": "pylint-dev__pylint-5446",
  "base_commit": "a1df7685a4e6a05b519ea011f16a2f0d49d08032",
  "patch": "diff --git a/pylint/checkers/similar.py b/pylint/checkers/similar.py\n--- a/pylint/checkers/similar.py\n+++ b/pylint/checkers/similar.py\n@@ -381,10 +381,19 @@ def append_stream(\n         else:\n             readlines = stream.readlines  # type: ignore[assignment] # hint parameter is incorrectly typed as non-optional\n         try:\n+            active_lines: List[str] = []\n+            if hasattr(self, \"linter\"):\n+                # Remove those lines that should be ignored because of disables\n+                for index, line in enumerate(readlines()):\n+                    if self.linter._is_one_message_enabled(\"R0801\", index + 1):  # type: ignore[attr-defined]\n+                        active_lines.append(line)\n+            else:\n+                active_lines = readlines()\n+\n             self.linesets.append(\n                 LineSet(\n                     streamid,\n-                    readlines(),\n+                    active_lines,\n                     self.ignore_comments,\n                     self.ignore_docstrings,\n                     self.ignore_imports,\n",
  "test_patch": "diff --git a/tests/regrtest_data/duplicate_data_raw_strings/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_all/__init__.py\nsimilarity index 100%\nrename from tests/regrtest_data/duplicate_data_raw_strings/__init__.py\nrename to tests/regrtest_data/duplicate_code/raw_strings_all/__init__.py\ndiff --git a/tests/regrtest_data/duplicate_data_raw_strings/first.py b/tests/regrtest_data/duplicate_code/raw_strings_all/first.py\nsimilarity index 100%\nrename from tests/regrtest_data/duplicate_data_raw_strings/first.py\nrename to tests/regrtest_data/duplicate_code/raw_strings_all/first.py\ndiff --git a/tests/regrtest_data/duplicate_data_raw_strings/second.py b/tests/regrtest_data/duplicate_code/raw_strings_all/second.py\nsimilarity index 100%\nrename from tests/regrtest_data/duplicate_data_raw_strings/second.py\nrename to tests/regrtest_data/duplicate_code/raw_strings_all/second.py\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_all/third.py b/tests/regrtest_data/duplicate_code/raw_strings_all/third.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_all/third.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_file/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_file/__init__.py\nnew file mode 100644\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_file/first.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_file/first.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_file/first.py\n@@ -0,0 +1,12 @@\n+# pylint: disable=duplicate-code\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_file/second.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_file/second.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_file/second.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_file/third.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_file/third.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_file/third.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/__init__.py\nnew file mode 100644\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/first.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/first.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/first.py\n@@ -0,0 +1,12 @@\n+# pylint: disable=duplicate-code\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/second.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/second.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/second.py\n@@ -0,0 +1,12 @@\n+# pylint: disable=duplicate-code\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/third.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/third.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_file_double/third.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_begin/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_begin/__init__.py\nnew file mode 100644\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_begin/first.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_begin/first.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_begin/first.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1  # pylint: disable=duplicate-code\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_begin/second.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_begin/second.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_begin/second.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_disable_all/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_disable_all/__init__.py\nnew file mode 100644\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_disable_all/first.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_disable_all/first.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_disable_all/first.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1  # pylint: disable=duplicate-code\n+    yyyy = 2  # pylint: disable=duplicate-code\n+    zzzz = 3  # pylint: disable=duplicate-code\n+    wwww = 4  # pylint: disable=duplicate-code\n+    vvvv = xxxx + yyyy + zzzz + wwww  # pylint: disable=duplicate-code\n+    return vvvv  # pylint: disable=duplicate-code\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_disable_all/second.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_disable_all/second.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_disable_all/second.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_end/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_end/__init__.py\nnew file mode 100644\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_end/first.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_end/first.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_end/first.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv  # pylint: disable=duplicate-code\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_end/second.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_end/second.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_end/second.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_middle/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_middle/__init__.py\nnew file mode 100644\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_middle/first.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_middle/first.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_middle/first.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3  # pylint: disable=duplicate-code\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_line_middle/second.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_middle/second.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_line_middle/second.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/__init__.py\nnew file mode 100644\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/first.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/first.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/first.py\n@@ -0,0 +1,12 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    # pylint: disable=duplicate-code\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/second.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/second.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/second.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/third.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/third.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope/third.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/__init__.py\nnew file mode 100644\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/first.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/first.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/first.py\n@@ -0,0 +1,12 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    # pylint: disable=duplicate-code\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/second.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/second.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/second.py\n@@ -0,0 +1,12 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    # pylint: disable=duplicate-code\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/third.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/third.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_double/third.py\n@@ -0,0 +1,11 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_second_function/__init__.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_second_function/__init__.py\nnew file mode 100644\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_second_function/first.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_second_function/first.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_second_function/first.py\n@@ -0,0 +1,21 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    # pylint: disable=duplicate-code\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\n+\n+\n+def look_busy_two():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_second_function/second.py b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_second_function/second.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/regrtest_data/duplicate_code/raw_strings_disable_scope_second_function/second.py\n@@ -0,0 +1,20 @@\n+r\"\"\"A raw docstring.\n+\"\"\"\n+\n+\n+def look_busy():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\n+\n+\n+def look_busy_two():\n+    xxxx = 1\n+    yyyy = 2\n+    zzzz = 3\n+    wwww = 4\n+    vvvv = xxxx + yyyy + zzzz + wwww\n+    return vvvv\ndiff --git a/tests/test_self.py b/tests/test_self.py\n--- a/tests/test_self.py\n+++ b/tests/test_self.py\n@@ -1121,14 +1121,6 @@ def test_jobs_score(self) -> None:\n         expected = \"Your code has been rated at 7.50/10\"\n         self._test_output([path, \"--jobs=2\", \"-ry\"], expected_output=expected)\n \n-    def test_duplicate_code_raw_strings(self) -> None:\n-        path = join(HERE, \"regrtest_data\", \"duplicate_data_raw_strings\")\n-        expected_output = \"Similar lines in 2 files\"\n-        self._test_output(\n-            [path, \"--disable=all\", \"--enable=duplicate-code\"],\n-            expected_output=expected_output,\n-        )\n-\n     def test_regression_parallel_mode_without_filepath(self) -> None:\n         # Test that parallel mode properly passes filepath\n         # https://github.com/PyCQA/pylint/issues/3564\ndiff --git a/tests/test_similar.py b/tests/test_similar.py\nnew file mode 100644\n--- /dev/null\n+++ b/tests/test_similar.py\n@@ -0,0 +1,141 @@\n+# Licensed under the GPL: https://www.gnu.org/licenses/old-licenses/gpl-2.0.html\n+# For details: https://github.com/PyCQA/pylint/blob/main/LICENSE\n+\n+\n+import contextlib\n+import os\n+import re\n+import sys\n+import warnings\n+from io import StringIO\n+from os.path import abspath, dirname, join\n+from typing import Iterator, List, TextIO\n+\n+import pytest\n+\n+from pylint.lint import Run\n+\n+HERE = abspath(dirname(__file__))\n+DATA = join(HERE, \"regrtest_data\", \"duplicate_code\")\n+CLEAN_PATH = re.escape(dirname(dirname(__file__)) + os.path.sep)\n+\n+\n+@contextlib.contextmanager\n+def _patch_streams(out: TextIO) -> Iterator:\n+    sys.stderr = sys.stdout = out\n+    try:\n+        yield\n+    finally:\n+        sys.stderr = sys.__stderr__\n+        sys.stdout = sys.__stdout__\n+\n+\n+class TestSimilarCodeChecker:\n+    def _runtest(self, args: List[str], code: int) -> None:\n+        \"\"\"Runs the tests and sees if output code is as expected.\"\"\"\n+        out = StringIO()\n+        pylint_code = self._run_pylint(args, out=out)\n+        output = out.getvalue()\n+        msg = f\"expected output status {code}, got {pylint_code}\"\n+        if output is not None:\n+            msg = f\"{msg}. Below pylint output: \\n{output}\"\n+        assert pylint_code == code, msg\n+\n+    @staticmethod\n+    def _run_pylint(args: List[str], out: TextIO) -> int:\n+        \"\"\"Runs pylint with a patched output.\"\"\"\n+        args = args + [\"--persistent=no\"]\n+        with _patch_streams(out):\n+            with pytest.raises(SystemExit) as cm:\n+                with warnings.catch_warnings():\n+                    warnings.simplefilter(\"ignore\")\n+                    Run(args)\n+            return cm.value.code\n+\n+    @staticmethod\n+    def _clean_paths(output: str) -> str:\n+        \"\"\"Normalize path to the tests directory.\"\"\"\n+        output = re.sub(CLEAN_PATH, \"\", output, flags=re.MULTILINE)\n+        return output.replace(\"\\\\\", \"/\")\n+\n+    def _test_output(self, args: List[str], expected_output: str) -> None:\n+        \"\"\"Tests if the output of a pylint run is as expected.\"\"\"\n+        out = StringIO()\n+        self._run_pylint(args, out=out)\n+        actual_output = self._clean_paths(out.getvalue())\n+        expected_output = self._clean_paths(expected_output)\n+        assert expected_output.strip() in actual_output.strip()\n+\n+    def test_duplicate_code_raw_strings_all(self) -> None:\n+        \"\"\"Test similar lines in 3 similar files.\"\"\"\n+        path = join(DATA, \"raw_strings_all\")\n+        expected_output = \"Similar lines in 2 files\"\n+        self._test_output(\n+            [path, \"--disable=all\", \"--enable=duplicate-code\"],\n+            expected_output=expected_output,\n+        )\n+\n+    def test_duplicate_code_raw_strings_disable_file(self) -> None:\n+        \"\"\"Tests disabling duplicate-code at the file level in a single file.\"\"\"\n+        path = join(DATA, \"raw_strings_disable_file\")\n+        expected_output = \"Similar lines in 2 files\"\n+        self._test_output(\n+            [path, \"--disable=all\", \"--enable=duplicate-code\"],\n+            expected_output=expected_output,\n+        )\n+\n+    def test_duplicate_code_raw_strings_disable_file_double(self) -> None:\n+        \"\"\"Tests disabling duplicate-code at the file level in two files.\"\"\"\n+        path = join(DATA, \"raw_strings_disable_file_double\")\n+        self._runtest([path, \"--disable=all\", \"--enable=duplicate-code\"], code=0)\n+\n+    def test_duplicate_code_raw_strings_disable_line_two(self) -> None:\n+        \"\"\"Tests disabling duplicate-code at a line at the begin of a piece of similar code.\"\"\"\n+        path = join(DATA, \"raw_strings_disable_line_begin\")\n+        expected_output = \"Similar lines in 2 files\"\n+        self._test_output(\n+            [path, \"--disable=all\", \"--enable=duplicate-code\"],\n+            expected_output=expected_output,\n+        )\n+\n+    def test_duplicate_code_raw_strings_disable_line_disable_all(self) -> None:\n+        \"\"\"Tests disabling duplicate-code with all similar lines disabled per line.\"\"\"\n+        path = join(DATA, \"raw_strings_disable_line_disable_all\")\n+        self._runtest([path, \"--disable=all\", \"--enable=duplicate-code\"], code=0)\n+\n+    def test_duplicate_code_raw_strings_disable_line_midle(self) -> None:\n+        \"\"\"Tests disabling duplicate-code at a line in the middle of a piece of similar code.\"\"\"\n+        path = join(DATA, \"raw_strings_disable_line_middle\")\n+        self._runtest([path, \"--disable=all\", \"--enable=duplicate-code\"], code=0)\n+\n+    def test_duplicate_code_raw_strings_disable_line_end(self) -> None:\n+        \"\"\"Tests disabling duplicate-code at a line at the end of a piece of similar code.\"\"\"\n+        path = join(DATA, \"raw_strings_disable_line_end\")\n+        expected_output = \"Similar lines in 2 files\"\n+        self._test_output(\n+            [path, \"--disable=all\", \"--enable=duplicate-code\"],\n+            expected_output=expected_output,\n+        )\n+\n+    def test_duplicate_code_raw_strings_disable_scope(self) -> None:\n+        \"\"\"Tests disabling duplicate-code at an inner scope level.\"\"\"\n+        path = join(DATA, \"raw_strings_disable_scope\")\n+        expected_output = \"Similar lines in 2 files\"\n+        self._test_output(\n+            [path, \"--disable=all\", \"--enable=duplicate-code\"],\n+            expected_output=expected_output,\n+        )\n+\n+    def test_duplicate_code_raw_strings_disable_scope_double(self) -> None:\n+        \"\"\"Tests disabling duplicate-code at an inner scope level in two files.\"\"\"\n+        path = join(DATA, \"raw_strings_disable_scope_double\")\n+        self._runtest([path, \"--disable=all\", \"--enable=duplicate-code\"], code=0)\n+\n+    def test_duplicate_code_raw_strings_disable_scope_function(self) -> None:\n+        \"\"\"Tests disabling duplicate-code at an inner scope level with another scope with similarity.\"\"\"\n+        path = join(DATA, \"raw_strings_disable_scope_second_function\")\n+        expected_output = \"Similar lines in 2 files\"\n+        self._test_output(\n+            [path, \"--disable=all\", \"--enable=duplicate-code\"],\n+            expected_output=expected_output,\n+        )\n",
  "problem_statement": "The duplicate-code (R0801) can't be disabled\nOriginally reported by: **Anonymous**\n\n---\n\nIt's seems like it's not possible to disable the duplicate code check on portions of a file. Looking at the source, I can see why as it's not a trivial thing to do (if you want to maintain the same scope semantics as other #pylint:enable/disable comments. This would be nice to have though (or I guess I could just cleanup my duplicate code).\n\n---\n- Bitbucket: https://bitbucket.org/logilab/pylint/issue/214\n\n",
  "hints_text": "_Original comment by_ **Radek Holý (BitBucket: [PyDeq](http://bitbucket.org/PyDeq), GitHub: @PyDeq?)**:\n\n---\n\nPylint marks even import blocks as duplicates. In my case, it is:\n\n```\n#!python\nimport contextlib\nimport io\nimport itertools\nimport os\nimport subprocess\nimport tempfile\n\n```\n\nI doubt it is possible to clean up/refactor the code to prevent this, thus it would be nice if it would ignore imports or if it would be possible to use the disable comment.\n\n_Original comment by_ **Buck Evan (BitBucket: [bukzor](http://bitbucket.org/bukzor), GitHub: @bukzor?)**:\n\n---\n\nI've run into this today.\n\nMy project has several setup.py files, which of course look quite similar, but can't really share code.\nI tried to `# pylint:disable=duplicate-code` just the line in question (`setup()`), but it did nothing.\n\nI'll have to turn the checker off entirely I think.\n\nany news on this issue ?\n\nNo one is currently working on this. This would be nice to have fixed, but unfortunately I didn't have time to look into it. A pull request would be appreciated though and would definitely move it forward.\n\n@gaspaio \nFYI I have created a fix in the following PR https://github.com/PyCQA/pylint/pull/1055\nCould you check if It work for you?\n\nIs this related to duplicate-except? it cannot be disabled either. \r\n\r\nsorry, Seems it is able to be disabled.\n@PCManticore as you mentioned, there is probably no good way to fix this issue for this version; What about fixing this in a \"[bad way](https://github.com/PyCQA/pylint/pull/1055)\" for this version, and later on in the planned version 3 you can [utilize a better engineered two-phase design](https://github.com/PyCQA/pylint/pull/1014#issuecomment-233185403) ?\r\n\r\nWhile sailing, sometimes the only way to fix your ship is ugly patching, and it's better than not fixing.\r\nA functioning tool is absolutely better than a \"perfectly engineered\" tool.\n> A functioning tool is absolutely better than a \"perfectly engineered\" tool.\r\n\r\nIt's better because it exists, unlike perfect engineering :D\nIs this issue resolved? I'm using pylint 2.1.1 and cannot seem to disable the warning with comments in the files which are printed in the warning.\nHi @levsa \r\nI have created a custom patch that you can use locally from:\r\n - https://github.com/PyCQA/pylint/pull/1055#issuecomment-384382126\r\n\r\nWe are using it 2.5 years ago and it is working fine.\r\n\r\nThe main issue is that the `state_lines` are not propagated for the methods used.\r\nThis patch just propagates them correctly.\r\n\nYou can use:\r\n```bash\r\nwget -q https://raw.githubusercontent.com/Vauxoo/pylint-conf/master/conf/pylint_pr1055.patch -O pylint_pr1055.patch\r\npatch -f -p0 $(python -c \"from __future__ import print_function; from pylint.checkers import similar; print(similar.__file__.rstrip('c'))\") -i pylint_pr1055.patch\r\n```\n@moylop260 Your fix doesn't work. Even if I have `# pylint: disable=duplicate-code` in each file with duplicate code, I still get errors.\nYou have duplicated comments too.\r\nCheck answer https://github.com/PyCQA/pylint/pull/1055#issuecomment-470572805\nStill have this issue on pylint = \"==2.3.1\"\nThe issue still there for latest python 2 pylint version 1.9.4\r\n\r\n`# pylint: disable=duplicate-code` does not work, while # pylint: disable=all` can disable the dup check.\nAlso have this issue with `pylint==2.3.1`\r\n\r\nEven if i add the the pragma in every file with duplicate code like @filips123, i still get the files with the pragma reported ....\r\n\r\nAny progress on this? I don't want to `# pylint: disable=all` for all affected files ...\nI am using pylint 2.4.0 for python 3 and I can see that `disable=duplicate-code` is working.\nI'm using pylint 2.4.4 and `# pylint: disable=duplicate-code` is not working for me.\nAlso on `2.4.4`\nAnd on 2.4.2\nanother confirmation of this issue on 2.4.4\nNot working for me `# pylint: disable=duplicate-code` at 2.4.4 version python 3.8\nAlso **not** woking at 2.4.4 with python 3.7.4 and `# pylint: disable=R0801` or `# pylint: disable=duplicate-code`\nAlso doesn't work. pylint 2.4.4, astroid 2.3.3, Python 3.8.2\nI found a solution to partially solve this.\r\n\r\nhttps://github.com/PyCQA/pylint/pull/1055#issuecomment-477253153\r\n\r\nUse pylintrc. Try changing the `min-similarity-lines` in the similarities section of your pylintrc config file.\r\n\r\n```INI\r\n[SIMILARITIES]\r\n\r\n# Minimum lines number of a similarity.\r\nmin-similarity-lines=4\r\n\r\n# Ignore comments when computing similarities.\r\nignore-comments=yes\r\n\r\n# Ignore docstrings when computing similarities.\r\nignore-docstrings=yes\r\n\r\n# Ignore imports when computing similarities.\r\nignore-imports=no\r\n```\r\n\r\n\n+1\nHappened to me on a overloaded method declaration, which is obviously identical as its parent class, and in my case its sister class, so pylint reports \"Similar lines in 3 files\" with the `def` and its 4 arguments (spanning on 6 lines, I have one argument per line due to type anotations).\r\n\r\nIt think this could be mitigated by whitelisting import statements and method declaration.\nJust been bitten by this issue today.\r\n\r\n> pylint 2.6.0\r\nastroid 2.4.2\r\nPython 3.9.1 (default, Jan 20 2021, 00:00:00) \r\n\r\nIncreasing `min-similarity-lines` is not actually a solution, as it will turn off duplicate code evaluation.\nIn my particular case I had two separate classes with similar inputs in the `def __init__`\r\n\r\nAs a workaround and what worked for me was to include the following in our pyproject.toml (which is the SIMILARITIES section if you use pylinr.rc):\r\n```\r\n[tool.pylint.SIMULARITIES]\r\nignore-comments = \"no\"\r\n```\r\n\r\nDoing this then allows pylint to not disregard the comments on lines. From there we added the `# pylint: disable=duplicate-code` to the end of one of the lines which now made this \"unique\" (although you could in practice use any comment text)\r\n\r\nThis is a better temporary workaround than the `min-similarity-lines` option as that:\r\n* misses other instance where you'd want that check\r\n* also doesnt return with a valid exit code even though rating is 10.00/10\nit is possible now with file pylint.rc with disable key and value duplicate-code, this issue can be closed and solve in my opnion #214\n> it is possible now with file pylint.rc with disable key and value duplicate-code, this issue can be closed and solve in my opnion #214\r\n\r\nThe main issue is not being able to use `# pylint: disable=duplicate-code` to exclude particular blocks of code. Disabling `duplicate-code` all together is not an acceptable solution. \nSince the issue was opened we added multiple option to ignore import, ignore docstrings and ignore signatures, so there is less and less reasons to want to disable it. But the problem still exists.\nSo any idea how to exclude particular blocks of code from the duplicated code checks without disabling the whole feature?\n> So any idea how to exclude particular blocks of code from the duplicated code checks without disabling the whole feature?\r\n\r\nRight now there isn't, this require a change in pylint.\nany news about this? It looks like many people have been bitten by this and it's marked as high prio\r\nthanks",
  "created_at": "2021-11-30T16:56:42Z",
  "version": "2.13",
  "FAIL_TO_PASS": "[\"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_disable_file_double\", \"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_disable_line_disable_all\", \"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_disable_line_midle\", \"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_disable_scope_double\"]",
  "PASS_TO_PASS": "[\"tests/test_self.py::TestRunTC::test_pkginfo\", \"tests/test_self.py::TestRunTC::test_all\", \"tests/test_self.py::TestRunTC::test_no_ext_file\", \"tests/test_self.py::TestRunTC::test_w0704_ignored\", \"tests/test_self.py::TestRunTC::test_exit_zero\", \"tests/test_self.py::TestRunTC::test_generate_config_option\", \"tests/test_self.py::TestRunTC::test_generate_config_option_order\", \"tests/test_self.py::TestRunTC::test_generate_config_disable_symbolic_names\", \"tests/test_self.py::TestRunTC::test_generate_rcfile_no_obsolete_methods\", \"tests/test_self.py::TestRunTC::test_nonexistent_config_file\", \"tests/test_self.py::TestRunTC::test_help_message_option\", \"tests/test_self.py::TestRunTC::test_error_help_message_option\", \"tests/test_self.py::TestRunTC::test_error_missing_arguments\", \"tests/test_self.py::TestRunTC::test_no_out_encoding\", \"tests/test_self.py::TestRunTC::test_parallel_execution\", \"tests/test_self.py::TestRunTC::test_parallel_execution_missing_arguments\", \"tests/test_self.py::TestRunTC::test_abbreviations_are_not_supported\", \"tests/test_self.py::TestRunTC::test_enable_all_works\", \"tests/test_self.py::TestRunTC::test_wrong_import_position_when_others_disabled\", \"tests/test_self.py::TestRunTC::test_import_itself_not_accounted_for_relative_imports\", \"tests/test_self.py::TestRunTC::test_reject_empty_indent_strings\", \"tests/test_self.py::TestRunTC::test_json_report_when_file_has_syntax_error\", \"tests/test_self.py::TestRunTC::test_json_report_when_file_is_missing\", \"tests/test_self.py::TestRunTC::test_json_report_does_not_escape_quotes\", \"tests/test_self.py::TestRunTC::test_information_category_disabled_by_default\", \"tests/test_self.py::TestRunTC::test_error_mode_shows_no_score\", \"tests/test_self.py::TestRunTC::test_evaluation_score_shown_by_default\", \"tests/test_self.py::TestRunTC::test_confidence_levels\", \"tests/test_self.py::TestRunTC::test_bom_marker\", \"tests/test_self.py::TestRunTC::test_pylintrc_plugin_duplicate_options\", \"tests/test_self.py::TestRunTC::test_pylintrc_comments_in_values\", \"tests/test_self.py::TestRunTC::test_no_crash_with_formatting_regex_defaults\", \"tests/test_self.py::TestRunTC::test_getdefaultencoding_crashes_with_lc_ctype_utf8\", \"tests/test_self.py::TestRunTC::test_parseable_file_path\", \"tests/test_self.py::TestRunTC::test_stdin[/mymodule.py]\", \"tests/test_self.py::TestRunTC::test_stdin[mymodule.py-mymodule-mymodule.py]\", \"tests/test_self.py::TestRunTC::test_stdin_missing_modulename\", \"tests/test_self.py::TestRunTC::test_relative_imports[False]\", \"tests/test_self.py::TestRunTC::test_relative_imports[True]\", \"tests/test_self.py::TestRunTC::test_stdin_syntaxerror\", \"tests/test_self.py::TestRunTC::test_version\", \"tests/test_self.py::TestRunTC::test_fail_under\", \"tests/test_self.py::TestRunTC::test_fail_on[-10-missing-function-docstring-fail_under_plus7_5.py-16]\", \"tests/test_self.py::TestRunTC::test_fail_on[6-missing-function-docstring-fail_under_plus7_5.py-16]\", \"tests/test_self.py::TestRunTC::test_fail_on[7.5-missing-function-docstring-fail_under_plus7_5.py-16]\", \"tests/test_self.py::TestRunTC::test_fail_on[7.6-missing-function-docstring-fail_under_plus7_5.py-16]\", \"tests/test_self.py::TestRunTC::test_fail_on[-11-missing-function-docstring-fail_under_minus10.py-22]\", \"tests/test_self.py::TestRunTC::test_fail_on[-10-missing-function-docstring-fail_under_minus10.py-22]\", \"tests/test_self.py::TestRunTC::test_fail_on[-9-missing-function-docstring-fail_under_minus10.py-22]\", \"tests/test_self.py::TestRunTC::test_fail_on[-5-missing-function-docstring-fail_under_minus10.py-22]\", \"tests/test_self.py::TestRunTC::test_fail_on[-10-broad-except-fail_under_plus7_5.py-0]\", \"tests/test_self.py::TestRunTC::test_fail_on[6-broad-except-fail_under_plus7_5.py-0]\", \"tests/test_self.py::TestRunTC::test_fail_on[7.5-broad-except-fail_under_plus7_5.py-0]\", \"tests/test_self.py::TestRunTC::test_fail_on[7.6-broad-except-fail_under_plus7_5.py-16]\", \"tests/test_self.py::TestRunTC::test_fail_on[-11-broad-except-fail_under_minus10.py-0]\", \"tests/test_self.py::TestRunTC::test_fail_on[-10-broad-except-fail_under_minus10.py-0]\", \"tests/test_self.py::TestRunTC::test_fail_on[-9-broad-except-fail_under_minus10.py-22]\", \"tests/test_self.py::TestRunTC::test_fail_on[-5-broad-except-fail_under_minus10.py-22]\", \"tests/test_self.py::TestRunTC::test_fail_on[-10-C0116-fail_under_plus7_5.py-16]\", \"tests/test_self.py::TestRunTC::test_fail_on[-10-C-fail_under_plus7_5.py-16]\", \"tests/test_self.py::TestRunTC::test_fail_on[-10-fake1,C,fake2-fail_under_plus7_5.py-16]\", \"tests/test_self.py::TestRunTC::test_fail_on[-10-C0115-fail_under_plus7_5.py-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_edge_case[opts0-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_edge_case[opts1-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_edge_case[opts2-16]\", \"tests/test_self.py::TestRunTC::test_fail_on_edge_case[opts3-16]\", \"tests/test_self.py::TestRunTC::test_modify_sys_path\", \"tests/test_self.py::TestRunTC::test_do_not_import_files_from_local_directory\", \"tests/test_self.py::TestRunTC::test_do_not_import_files_from_local_directory_with_pythonpath\", \"tests/test_self.py::TestRunTC::test_import_plugin_from_local_directory_if_pythonpath_cwd\", \"tests/test_self.py::TestRunTC::test_allow_import_of_files_found_in_modules_during_parallel_check\", \"tests/test_self.py::TestRunTC::test_can_list_directories_without_dunder_init\", \"tests/test_self.py::TestRunTC::test_jobs_score\", \"tests/test_self.py::TestRunTC::test_regression_parallel_mode_without_filepath\", \"tests/test_self.py::TestRunTC::test_output_file_valid_path\", \"tests/test_self.py::TestRunTC::test_output_file_invalid_path_exits_with_code_32\", \"tests/test_self.py::TestRunTC::test_fail_on_exit_code[args0-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_exit_code[args1-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_exit_code[args2-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_exit_code[args3-6]\", \"tests/test_self.py::TestRunTC::test_fail_on_exit_code[args4-6]\", \"tests/test_self.py::TestRunTC::test_fail_on_exit_code[args5-22]\", \"tests/test_self.py::TestRunTC::test_fail_on_exit_code[args6-22]\", \"tests/test_self.py::TestRunTC::test_fail_on_exit_code[args7-6]\", \"tests/test_self.py::TestRunTC::test_fail_on_exit_code[args8-22]\", \"tests/test_self.py::TestRunTC::test_one_module_fatal_error\", \"tests/test_self.py::TestRunTC::test_fail_on_info_only_exit_code[args0-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_info_only_exit_code[args1-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_info_only_exit_code[args2-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_info_only_exit_code[args3-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_info_only_exit_code[args4-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_info_only_exit_code[args5-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_info_only_exit_code[args6-0]\", \"tests/test_self.py::TestRunTC::test_fail_on_info_only_exit_code[args7-1]\", \"tests/test_self.py::TestRunTC::test_fail_on_info_only_exit_code[args8-1]\", \"tests/test_self.py::TestRunTC::test_output_file_can_be_combined_with_output_format_option[text-tests/regrtest_data/unused_variable.py:4:4:\", \"tests/test_self.py::TestRunTC::test_output_file_can_be_combined_with_output_format_option[parseable-tests/regrtest_data/unused_variable.py:4:\", \"tests/test_self.py::TestRunTC::test_output_file_can_be_combined_with_output_format_option[msvs-tests/regrtest_data/unused_variable.py(4):\", \"tests/test_self.py::TestRunTC::test_output_file_can_be_combined_with_output_format_option[colorized-tests/regrtest_data/unused_variable.py:4:4:\", \"tests/test_self.py::TestRunTC::test_output_file_can_be_combined_with_output_format_option[json-\\\"message\\\":\", \"tests/test_self.py::TestRunTC::test_output_file_can_be_combined_with_custom_reporter\", \"tests/test_self.py::TestRunTC::test_output_file_specified_in_rcfile\", \"tests/test_self.py::TestRunTC::test_enable_all_extensions\", \"tests/test_self.py::TestRunTC::test_load_text_repoter_if_not_provided\", \"tests/test_self.py::TestRunTC::test_regex_paths_csv_validator\", \"tests/test_self.py::TestRunTC::test_regression_recursive\", \"tests/test_self.py::TestRunTC::test_recursive\", \"tests/test_self.py::TestRunTC::test_recursive_current_dir\", \"tests/test_self.py::TestRunTC::test_regression_recursive_current_dir\", \"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_all\", \"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_disable_file\", \"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_disable_line_two\", \"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_disable_line_end\", \"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_disable_scope\", \"tests/test_similar.py::TestSimilarCodeChecker::test_duplicate_code_raw_strings_disable_scope_function\"]",
  "environment_setup_commit": "3b2fbaec045697d53bdd4435e59dbfc2b286df4b",
  "_download_metadata": {
    "downloaded_at": "2025-10-07T21:23:30.910341",
    "dataset_name": "swe-bench",
    "split": "test",
    "downloader_version": "0.1.0"
  }
}