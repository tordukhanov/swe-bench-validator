{
  "repo": "pytest-dev/pytest",
  "instance_id": "pytest-dev__pytest-8987",
  "base_commit": "a446ee81fd6674c2b7d1f0ee76467f1ffc1619fc",
  "patch": "diff --git a/src/_pytest/mark/expression.py b/src/_pytest/mark/expression.py\n--- a/src/_pytest/mark/expression.py\n+++ b/src/_pytest/mark/expression.py\n@@ -6,7 +6,7 @@\n expr:       and_expr ('or' and_expr)*\n and_expr:   not_expr ('and' not_expr)*\n not_expr:   'not' not_expr | '(' expr ')' | ident\n-ident:      (\\w|:|\\+|-|\\.|\\[|\\])+\n+ident:      (\\w|:|\\+|-|\\.|\\[|\\]|\\\\)+\n \n The semantics are:\n \n@@ -88,7 +88,7 @@ def lex(self, input: str) -> Iterator[Token]:\n                 yield Token(TokenType.RPAREN, \")\", pos)\n                 pos += 1\n             else:\n-                match = re.match(r\"(:?\\w|:|\\+|-|\\.|\\[|\\])+\", input[pos:])\n+                match = re.match(r\"(:?\\w|:|\\+|-|\\.|\\[|\\]|\\\\)+\", input[pos:])\n                 if match:\n                     value = match.group(0)\n                     if value == \"or\":\n",
  "test_patch": "diff --git a/testing/test_mark_expression.py b/testing/test_mark_expression.py\n--- a/testing/test_mark_expression.py\n+++ b/testing/test_mark_expression.py\n@@ -66,6 +66,20 @@ def test_syntax_oddeties(expr: str, expected: bool) -> None:\n     assert evaluate(expr, matcher) is expected\n \n \n+def test_backslash_not_treated_specially() -> None:\n+    r\"\"\"When generating nodeids, if the source name contains special characters\n+    like a newline, they are escaped into two characters like \\n. Therefore, a\n+    user will never need to insert a literal newline, only \\n (two chars). So\n+    mark expressions themselves do not support escaping, instead they treat\n+    backslashes as regular identifier characters.\"\"\"\n+    matcher = {r\"\\nfoo\\n\"}.__contains__\n+\n+    assert evaluate(r\"\\nfoo\\n\", matcher)\n+    assert not evaluate(r\"foo\", matcher)\n+    with pytest.raises(ParseError):\n+        evaluate(\"\\nfoo\\n\", matcher)\n+\n+\n @pytest.mark.parametrize(\n     (\"expr\", \"column\", \"message\"),\n     (\n@@ -129,6 +143,7 @@ def test_syntax_errors(expr: str, column: int, message: str) -> None:\n         \":::\",\n         \"a:::c\",\n         \"a+-b\",\n+        r\"\\nhe\\\\l\\lo\\n\\t\\rbye\",\n         \"אבגד\",\n         \"aaאבגדcc\",\n         \"a[bcd]\",\n@@ -156,7 +171,6 @@ def test_valid_idents(ident: str) -> None:\n     \"ident\",\n     (\n         \"/\",\n-        \"\\\\\",\n         \"^\",\n         \"*\",\n         \"=\",\n",
  "problem_statement": "pytest -k doesn't work with \"\\\"?\n### Discussed in https://github.com/pytest-dev/pytest/discussions/8982\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **nguydavi** August  7, 2021</sup>\r\nHey!\r\n\r\nI've been trying to use `pytest -k` passing the name I got by parametrizing my test. For example,\r\n\r\n```\r\n$ pytest -vk 'test_solution[foo.py-5\\n10\\n-16\\n]' validate.py\r\n=========================================================================================================== test session starts ============================================================================================================platform linux -- Python 3.8.10, pytest-6.2.4, py-1.10.0, pluggy-0.13.1 -- /usr/bin/python3\r\ncachedir: .pytest_cache\r\nrootdir: /home/david/foo\r\ncollected 4 items\r\n\r\n========================================================================================================== no tests ran in 0.01s ===========================================================================================================ERROR: Wrong expression passed to '-k': test_solution[foo.py-5\\n10\\n-16\\n]: at column 23: unexpected character \"\\\"\r\n```\r\n\r\nNote the error message\r\n```\r\nERROR: Wrong expression passed to '-k': test_solution[foo.py-5\\n10\\n-16\\n]: at column 23: unexpected character \"\\\"\r\n```\r\n\r\nI tried escaping the `\\` but that didn't work, the only way I can make it work is to remove the backslashes completely,\r\n\r\n```\r\n$ pytest -vk 'test_solution[foo.py-5 and 10' validate.py\r\n```\r\n\r\nIs `\\` just not supported by `-k` ? Or am I missing something ?\r\n\r\nThanks!\r\n\r\nEDIT:\r\nA possible test case\r\n```\r\n@pytest.mark.parametrize(\r\n    \"param1, param2\",\r\n    [\r\n        pytest.param(\r\n            '5\\n10\\n', '16\\n'\r\n        ),\r\n    ],\r\n)\r\ndef test_solution(param1, param2):\r\n  pass\r\n```\r\nWhich is then referred by `pytest` as `test_solution[5\\n10\\n-16\\n]` . Essentially a new line character `\\n` in the string brings the issue (or any escaped character probably)</div>\n",
  "hints_text": "",
  "created_at": "2021-08-08T08:58:47Z",
  "version": "7.0",
  "FAIL_TO_PASS": "[\"testing/test_mark_expression.py::test_backslash_not_treated_specially\", \"testing/test_mark_expression.py::test_valid_idents[\\\\\\\\nhe\\\\\\\\\\\\\\\\l\\\\\\\\lo\\\\\\\\n\\\\\\\\t\\\\\\\\rbye]\"]",
  "PASS_TO_PASS": "[\"testing/test_mark_expression.py::test_empty_is_false\", \"testing/test_mark_expression.py::test_basic[true-True0]\", \"testing/test_mark_expression.py::test_basic[true-True1]\", \"testing/test_mark_expression.py::test_basic[false-False]\", \"testing/test_mark_expression.py::test_basic[not\", \"testing/test_mark_expression.py::test_basic[true\", \"testing/test_mark_expression.py::test_basic[false\", \"testing/test_mark_expression.py::test_basic[(not\", \"testing/test_mark_expression.py::test_syntax_oddeties[\", \"testing/test_mark_expression.py::test_syntax_oddeties[(\", \"testing/test_mark_expression.py::test_syntax_oddeties[not\", \"testing/test_mark_expression.py::test_syntax_errors[(-2-expected\", \"testing/test_mark_expression.py::test_syntax_errors[\", \"testing/test_mark_expression.py::test_syntax_errors[)-1-expected\", \"testing/test_mark_expression.py::test_syntax_errors[)\", \"testing/test_mark_expression.py::test_syntax_errors[not-4-expected\", \"testing/test_mark_expression.py::test_syntax_errors[not\", \"testing/test_mark_expression.py::test_syntax_errors[(not)-5-expected\", \"testing/test_mark_expression.py::test_syntax_errors[and-1-expected\", \"testing/test_mark_expression.py::test_syntax_errors[ident\", \"testing/test_mark_expression.py::test_valid_idents[.]\", \"testing/test_mark_expression.py::test_valid_idents[...]\", \"testing/test_mark_expression.py::test_valid_idents[:::]\", \"testing/test_mark_expression.py::test_valid_idents[a:::c]\", \"testing/test_mark_expression.py::test_valid_idents[a+-b]\", \"testing/test_mark_expression.py::test_valid_idents[\\\\u05d0\\\\u05d1\\\\u05d2\\\\u05d3]\", \"testing/test_mark_expression.py::test_valid_idents[aa\\\\u05d0\\\\u05d1\\\\u05d2\\\\u05d3cc]\", \"testing/test_mark_expression.py::test_valid_idents[a[bcd]]\", \"testing/test_mark_expression.py::test_valid_idents[1234]\", \"testing/test_mark_expression.py::test_valid_idents[1234abcd]\", \"testing/test_mark_expression.py::test_valid_idents[1234and]\", \"testing/test_mark_expression.py::test_valid_idents[notandor]\", \"testing/test_mark_expression.py::test_valid_idents[not_and_or]\", \"testing/test_mark_expression.py::test_valid_idents[not[and]or]\", \"testing/test_mark_expression.py::test_valid_idents[1234+5678]\", \"testing/test_mark_expression.py::test_valid_idents[123.232]\", \"testing/test_mark_expression.py::test_valid_idents[True]\", \"testing/test_mark_expression.py::test_valid_idents[False]\", \"testing/test_mark_expression.py::test_valid_idents[None]\", \"testing/test_mark_expression.py::test_valid_idents[if]\", \"testing/test_mark_expression.py::test_valid_idents[else]\", \"testing/test_mark_expression.py::test_valid_idents[while]\", \"testing/test_mark_expression.py::test_invalid_idents[/]\", \"testing/test_mark_expression.py::test_invalid_idents[^]\", \"testing/test_mark_expression.py::test_invalid_idents[*]\", \"testing/test_mark_expression.py::test_invalid_idents[=]\", \"testing/test_mark_expression.py::test_invalid_idents[&]\", \"testing/test_mark_expression.py::test_invalid_idents[%]\", \"testing/test_mark_expression.py::test_invalid_idents[$]\", \"testing/test_mark_expression.py::test_invalid_idents[#]\", \"testing/test_mark_expression.py::test_invalid_idents[@]\", \"testing/test_mark_expression.py::test_invalid_idents[!]\", \"testing/test_mark_expression.py::test_invalid_idents[~]\", \"testing/test_mark_expression.py::test_invalid_idents[{]\", \"testing/test_mark_expression.py::test_invalid_idents[}]\", \"testing/test_mark_expression.py::test_invalid_idents[\\\"]\", \"testing/test_mark_expression.py::test_invalid_idents[']\", \"testing/test_mark_expression.py::test_invalid_idents[|]\", \"testing/test_mark_expression.py::test_invalid_idents[;]\", \"testing/test_mark_expression.py::test_invalid_idents[\\\\u2190]\"]",
  "environment_setup_commit": "e2ee3144ed6e241dea8d96215fcdca18b3892551",
  "_download_metadata": {
    "downloaded_at": "2025-10-07T21:23:30.945264",
    "dataset_name": "swe-bench",
    "split": "test",
    "downloader_version": "0.1.0"
  }
}