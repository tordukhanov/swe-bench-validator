{
  "repo": "sympy/sympy",
  "instance_id": "sympy__sympy-20438",
  "base_commit": "33b47e4bd60e2302e42616141e76285038b724d6",
  "patch": "diff --git a/sympy/core/relational.py b/sympy/core/relational.py\n--- a/sympy/core/relational.py\n+++ b/sympy/core/relational.py\n@@ -302,9 +302,12 @@ def equals(self, other, failing_expression=False):\n \n     def _eval_simplify(self, **kwargs):\n         from .add import Add\n+        from sympy.core.expr import Expr\n         r = self\n         r = r.func(*[i.simplify(**kwargs) for i in r.args])\n         if r.is_Relational:\n+            if not isinstance(r.lhs, Expr) or not isinstance(r.rhs, Expr):\n+                return r\n             dif = r.lhs - r.rhs\n             # replace dif with a valid Number that will\n             # allow a definitive comparison with 0\n@@ -557,11 +560,14 @@ def binary_symbols(self):\n \n     def _eval_simplify(self, **kwargs):\n         from .add import Add\n+        from sympy.core.expr import Expr\n         from sympy.solvers.solveset import linear_coeffs\n         # standard simplify\n         e = super()._eval_simplify(**kwargs)\n         if not isinstance(e, Equality):\n             return e\n+        if not isinstance(e.lhs, Expr) or not isinstance(e.rhs, Expr):\n+            return e\n         free = self.free_symbols\n         if len(free) == 1:\n             try:\ndiff --git a/sympy/sets/handlers/comparison.py b/sympy/sets/handlers/comparison.py\n--- a/sympy/sets/handlers/comparison.py\n+++ b/sympy/sets/handlers/comparison.py\n@@ -23,12 +23,6 @@ def _eval_is_eq(lhs, rhs): # noqa: F811\n                lhs.left_open == rhs.left_open,\n                lhs.right_open == rhs.right_open)\n \n-\n-@dispatch(FiniteSet, Interval) # type:ignore\n-def _eval_is_eq(lhs, rhs): # noqa: F811\n-    return False\n-\n-\n @dispatch(FiniteSet, FiniteSet) # type:ignore\n def _eval_is_eq(lhs, rhs): # noqa: F811\n     def all_in_both():\n@@ -56,4 +50,4 @@ def _eval_is_eq(lhs, rhs): # noqa: F811\n \n @dispatch(Set, Set) # type:ignore\n def _eval_is_eq(lhs, rhs): # noqa: F811\n-    return None\n+    return tfn[fuzzy_and(a.is_subset(b) for a, b in [(lhs, rhs), (rhs, lhs)])]\ndiff --git a/sympy/sets/handlers/issubset.py b/sympy/sets/handlers/issubset.py\n--- a/sympy/sets/handlers/issubset.py\n+++ b/sympy/sets/handlers/issubset.py\n@@ -1,7 +1,7 @@\n from sympy import S, Symbol\n from sympy.core.logic import fuzzy_and, fuzzy_bool, fuzzy_not, fuzzy_or\n from sympy.core.relational import Eq\n-from sympy.sets.sets import FiniteSet, Interval, Set, Union\n+from sympy.sets.sets import FiniteSet, Interval, Set, Union, ProductSet\n from sympy.sets.fancysets import Complexes, Reals, Range, Rationals\n from sympy.multipledispatch import dispatch\n \n@@ -133,3 +133,7 @@ def is_subset_sets(a, b): # noqa:F811\n @dispatch(Rationals, Range)  # type: ignore # noqa:F811\n def is_subset_sets(a, b): # noqa:F811\n     return False\n+\n+@dispatch(ProductSet, FiniteSet)  # type: ignore # noqa:F811\n+def is_subset_sets(a_ps, b_fs): # noqa:F811\n+    return fuzzy_and(b_fs.contains(x) for x in a_ps)\n",
  "test_patch": "diff --git a/sympy/sets/tests/test_sets.py b/sympy/sets/tests/test_sets.py\n--- a/sympy/sets/tests/test_sets.py\n+++ b/sympy/sets/tests/test_sets.py\n@@ -1251,7 +1251,7 @@ def test_Eq():\n     assert Eq(FiniteSet({x, y}).subs(y, x+1), FiniteSet({x})) is S.false\n     assert Eq(FiniteSet({x, y}), FiniteSet({x})).subs(y, x+1) is S.false\n \n-    assert Eq(ProductSet({1}, {2}), Interval(1, 2)) not in (S.true, S.false)\n+    assert Eq(ProductSet({1}, {2}), Interval(1, 2)) is S.false\n     assert Eq(ProductSet({1}), ProductSet({1}, {2})) is S.false\n \n     assert Eq(FiniteSet(()), FiniteSet(1)) is S.false\n@@ -1597,6 +1597,17 @@ def test_issue_20089():\n     assert A.issubset(C)\n     assert B.issubset(C)\n \n+def test_issue_19378():\n+    a = FiniteSet(1, 2)\n+    b = ProductSet(a, a)\n+    c = FiniteSet((1, 1), (1, 2), (2, 1), (2, 2))\n+    assert b.is_subset(c) is True\n+    d = FiniteSet(1)\n+    assert b.is_subset(d) is False\n+    assert Eq(c, b).simplify() is S.true\n+    assert Eq(a, c).simplify() is S.false\n+    assert Eq({1}, {x}).simplify() == Eq({1}, {x})\n+\n def test_issue_20379():\n     #https://github.com/sympy/sympy/issues/20379\n     x = pi - 3.14159265358979\n",
  "problem_statement": "`is_subset` gives wrong results\n@sylee957 Current status on `master`,\r\n```python\r\n>>> a = FiniteSet(1, 2)\r\n>>> b = ProductSet(a, a)\r\n>>> c = FiniteSet((1, 1), (1, 2), (2, 1), (2, 2))\r\n>>> b.intersection(c) == c.intersection(b)\r\nTrue\r\n>>> b.is_subset(c)\r\n>>> c.is_subset(b)\r\nTrue\r\n>>> Eq(b, c).simplify()\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.6/code.py\", line 91, in runcode\r\n    exec(code, self.locals)\r\n  File \"<console>\", line 1, in <module>\r\n  File \"/home/czgdp1807ssd/sympy_project/sympy/sympy/core/basic.py\", line 1655, in simplify\r\n    return simplify(self, **kwargs)\r\n  File \"/home/czgdp1807ssd/sympy_project/sympy/sympy/simplify/simplify.py\", line 559, in simplify\r\n    return _eval_simplify(**kwargs)\r\n  File \"/home/czgdp1807ssd/sympy_project/sympy/sympy/core/relational.py\", line 646, in _eval_simplify\r\n    e = super(Equality, self)._eval_simplify(**kwargs)\r\n  File \"/home/czgdp1807ssd/sympy_project/sympy/sympy/core/relational.py\", line 308, in _eval_simplify\r\n    elif dif.equals(0):  # XXX this is expensive\r\nAttributeError: 'Complement' object has no attribute 'equals'\r\n>>> b.rewrite(FiniteSet)\r\n      2\r\n{1, 2} \r\n>>> \r\n```\r\n\r\n_Originally posted by @czgdp1807 in https://github.com/sympy/sympy/pull/16764#issuecomment-592606532_\n",
  "hints_text": "is_subset doesn't work ProductSet.is_subset(FiniteSet).",
  "created_at": "2020-11-17T08:24:33Z",
  "version": "1.8",
  "FAIL_TO_PASS": "[\"test_Eq\", \"test_issue_19378\"]",
  "PASS_TO_PASS": "[\"test_imageset\", \"test_is_empty\", \"test_is_finiteset\", \"test_deprecated_is_EmptySet\", \"test_interval_arguments\", \"test_interval_symbolic_end_points\", \"test_interval_is_empty\", \"test_union\", \"test_union_iter\", \"test_union_is_empty\", \"test_difference\", \"test_Complement\", \"test_set_operations_nonsets\", \"test_complement\", \"test_intersect1\", \"test_intersection\", \"test_issue_9623\", \"test_is_disjoint\", \"test_ProductSet__len__\", \"test_ProductSet\", \"test_ProductSet_of_single_arg_is_not_arg\", \"test_ProductSet_is_empty\", \"test_interval_subs\", \"test_interval_to_mpi\", \"test_set_evalf\", \"test_measure\", \"test_is_subset\", \"test_is_proper_subset\", \"test_is_superset\", \"test_is_proper_superset\", \"test_contains\", \"test_interval_symbolic\", \"test_union_contains\", \"test_is_number\", \"test_Interval_is_left_unbounded\", \"test_Interval_is_right_unbounded\", \"test_Interval_as_relational\", \"test_Finite_as_relational\", \"test_Union_as_relational\", \"test_Intersection_as_relational\", \"test_Complement_as_relational\", \"test_SymmetricDifference_as_relational\", \"test_EmptySet\", \"test_finite_basic\", \"test_product_basic\", \"test_real\", \"test_supinf\", \"test_universalset\", \"test_Union_of_ProductSets_shares\", \"test_Interval_free_symbols\", \"test_image_interval\", \"test_image_piecewise\", \"test_image_FiniteSet\", \"test_image_Union\", \"test_image_EmptySet\", \"test_issue_5724_7680\", \"test_boundary\", \"test_boundary_Union\", \"test_boundary_ProductSet\", \"test_boundary_ProductSet_line\", \"test_is_open\", \"test_is_closed\", \"test_closure\", \"test_interior\", \"test_issue_7841\", \"test_SymmetricDifference\", \"test_issue_9536\", \"test_issue_9637\", \"test_issue_9808\", \"test_issue_9956\", \"test_issue_Symbol_inter\", \"test_issue_11827\", \"test_issue_10113\", \"test_issue_10248\", \"test_issue_9447\", \"test_issue_10337\", \"test_issue_10326\", \"test_issue_2799\", \"test_issue_9706\", \"test_issue_8257\", \"test_issue_10931\", \"test_issue_11174\", \"test_issue_18505\", \"test_finite_set_intersection\", \"test_union_intersection_constructor\", \"test_Union_contains\", \"test_DisjointUnion\", \"test_DisjointUnion_is_empty\", \"test_DisjointUnion_is_iterable\", \"test_DisjointUnion_contains\", \"test_DisjointUnion_iter\", \"test_DisjointUnion_len\", \"test_issue_20089\"]",
  "environment_setup_commit": "3ac1464b8840d5f8b618a654f9fbf09c452fe969",
  "_download_metadata": {
    "downloaded_at": "2025-10-07T21:23:31.138329",
    "dataset_name": "swe-bench",
    "split": "test",
    "downloader_version": "0.1.0"
  }
}