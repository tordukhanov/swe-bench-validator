{
  "repo": "matplotlib/matplotlib",
  "instance_id": "matplotlib__matplotlib-23203",
  "base_commit": "028f07c869c4c0084c134a8b613aad4f5d111c7f",
  "patch": "diff --git a/lib/matplotlib/colorbar.py b/lib/matplotlib/colorbar.py\n--- a/lib/matplotlib/colorbar.py\n+++ b/lib/matplotlib/colorbar.py\n@@ -1617,7 +1617,8 @@ def make_axes_gridspec(parent, *, location=None, orientation=None,\n             aspect = 1 / aspect\n \n     parent.set_subplotspec(ss_main)\n-    parent.set_anchor(loc_settings[\"panchor\"])\n+    if panchor is not False:\n+        parent.set_anchor(panchor)\n \n     fig = parent.get_figure()\n     cax = fig.add_subplot(ss_cb, label=\"<colorbar>\")\n",
  "test_patch": "diff --git a/lib/matplotlib/tests/test_colorbar.py b/lib/matplotlib/tests/test_colorbar.py\n--- a/lib/matplotlib/tests/test_colorbar.py\n+++ b/lib/matplotlib/tests/test_colorbar.py\n@@ -211,11 +211,23 @@ def test_colorbar_positioning(use_gridspec):\n \n \n def test_colorbar_single_ax_panchor_false():\n-    # Just smoketesting that this doesn't crash.  Note that this differs from\n-    # the tests above with panchor=False because there use_gridspec is actually\n-    # ineffective: passing *ax* as lists always disable use_gridspec.\n+    # Note that this differs from the tests above with panchor=False because\n+    # there use_gridspec is actually ineffective: passing *ax* as lists always\n+    # disables use_gridspec.\n+    ax = plt.subplot(111, anchor='N')\n     plt.imshow([[0, 1]])\n     plt.colorbar(panchor=False)\n+    assert ax.get_anchor() == 'N'\n+\n+\n+@pytest.mark.parametrize('constrained', [False, True],\n+                         ids=['standard', 'constrained'])\n+def test_colorbar_single_ax_panchor_east(constrained):\n+    fig = plt.figure(constrained_layout=constrained)\n+    ax = fig.add_subplot(111, anchor='N')\n+    plt.imshow([[0, 1]])\n+    plt.colorbar(panchor='E')\n+    assert ax.get_anchor() == 'E'\n \n \n @image_comparison(['contour_colorbar.png'], remove_text=True)\n",
  "problem_statement": "[Bug]: colorbar ignores keyword panchor=False\n### Bug summary\r\n\r\n`colorbar` seems to ignore the keyword setting `panchor=False`\r\n\r\n### Code for reproduction\r\n\r\n```python\r\nimport matplotlib\r\nprint('mpl version:', matplotlib.__version__)\r\nimport matplotlib.pyplot as plt\r\nimport numpy as np\r\n\r\nfig = plt.figure(figsize=(5, 8))\r\nax = fig.add_subplot(1, 1, 1, aspect=0.5, anchor=\"N\")\r\n\r\na = np.arange(12)[:,np.newaxis] * np.ones(8)\r\nlevels = np.arange(1.5, 10, 2)\r\n\r\nplt.contourf(a, cmap='RdYlBu', levels=levels, extend='both')\r\nprint('anchor before colorbar:', ax.get_anchor())\r\nplt.colorbar(orientation='horizontal', panchor=False)\r\nprint('anchor after colorbar:', ax.get_anchor())\r\n```\r\n\r\n\r\n### Actual outcome\r\n\r\n```\r\nmpl version: 3.6.0.dev2341+g3df958c760\r\nanchor before colorbar: N\r\nanchor after colorbar: (0.5, 0.0)\r\n```\r\n\r\n### Expected outcome\r\n\r\nMy reading of the [docs](https://matplotlib.org/devdocs/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar) is that the axes anchor should still be \"N\" after I add the colorbar.  Though given #18752, it's possible I have misunderstood!\r\n\r\n> panchor(float, float), or False, optional\r\n> \r\n> The anchor point of the colorbar parent axes. If False, the parent axes' anchor will be unchanged. Defaults to (1.0, 0.5) if vertical; (0.5, 0.0) if horizontal.\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Operating system\r\n\r\n_No response_\r\n\r\n### Matplotlib Version\r\n\r\n`main` branch (3.6.0.dev2341+g3df958c760), 3.5.2 and some older (3.3+) versions.\r\n\r\n### Matplotlib Backend\r\n\r\n_No response_\r\n\r\n### Python version\r\n\r\n_No response_\r\n\r\n### Jupyter version\r\n\r\n_No response_\r\n\r\n### Installation\r\n\r\n_No response_\n",
  "hints_text": "I think maybe this is the problem line:\r\nhttps://github.com/matplotlib/matplotlib/blob/08732854e815ccbc99f382d99609255929979515/lib/matplotlib/colorbar.py#L1620\r\n\r\nand it should be handled the same as in `make_axes`\r\nhttps://github.com/matplotlib/matplotlib/blob/08732854e815ccbc99f382d99609255929979515/lib/matplotlib/colorbar.py#L1459\r\n\r\nhttps://github.com/matplotlib/matplotlib/blob/08732854e815ccbc99f382d99609255929979515/lib/matplotlib/colorbar.py#L1507-L1508\nThis was recently changed in https://github.com/matplotlib/matplotlib/pull/22776 to fix a problem introduced in https://github.com/matplotlib/matplotlib/pull/20129\r\n\r\nMaybe @QuLogic and @anntzer knows more about the details.\nActually the code prior to #20129 also didn't have the `if loc_settings[\"panchor\"] is not False:` check, so I don't think my changes really matter here?  Without having carefully checked, the proposed fix makes sense, though.",
  "created_at": "2022-06-04T19:19:07Z",
  "version": "3.5",
  "FAIL_TO_PASS": "[\"lib/matplotlib/tests/test_colorbar.py::test_colorbar_single_ax_panchor_false\"]",
  "PASS_TO_PASS": "[\"lib/matplotlib/tests/test_colorbar.py::test_colorbar_extension_shape[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_extension_length[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_extension_inverted_axis[min-expected0-horizontal]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_extension_inverted_axis[min-expected0-vertical]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_extension_inverted_axis[max-expected1-horizontal]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_extension_inverted_axis[max-expected1-vertical]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_extension_inverted_axis[both-expected2-horizontal]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_extension_inverted_axis[both-expected2-vertical]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_positioning[png-True]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_positioning[png-False]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_single_ax_panchor_east[standard]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_single_ax_panchor_east[constrained]\", \"lib/matplotlib/tests/test_colorbar.py::test_contour_colorbar[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_gridspec_make_colorbar[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_single_scatter[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_remove_from_figure[no\", \"lib/matplotlib/tests/test_colorbar.py::test_remove_from_figure[with\", \"lib/matplotlib/tests/test_colorbar.py::test_remove_from_figure_cl\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbarbase\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_closed_patch[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_ticks\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_minorticks_on_off\", \"lib/matplotlib/tests/test_colorbar.py::test_cbar_minorticks_for_rc_xyminortickvisible\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_autoticks\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_autotickslog\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_get_ticks\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_lognorm_extension[both]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_lognorm_extension[min]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_lognorm_extension[max]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_powernorm_extension\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_axes_kw\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_log_minortick_labels\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_renorm\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_format[%4.2e]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_format[{x:.2e}]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_scale_reset\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_get_ticks_2\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_inverted_ticks\", \"lib/matplotlib/tests/test_colorbar.py::test_mappable_no_alpha\", \"lib/matplotlib/tests/test_colorbar.py::test_mappable_2d_alpha\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_label\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_int[clim0]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_int[clim1]\", \"lib/matplotlib/tests/test_colorbar.py::test_anchored_cbar_position_using_specgrid\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_change_lim_scale[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_axes_handles_same_functions[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_inset_colorbar_layout\", \"lib/matplotlib/tests/test_colorbar.py::test_twoslope_colorbar[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_remove_cb_whose_mappable_has_no_figure[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_aspects\", \"lib/matplotlib/tests/test_colorbar.py::test_proportional_colorbars[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_negative_boundarynorm\", \"lib/matplotlib/tests/test_colorbar.py::test_boundaries[png]\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_no_warning_rcparams_grid_true\", \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_set_formatter_locator\", \"lib/matplotlib/tests/test_colorbar.py::test_offset_text_loc\", \"lib/matplotlib/tests/test_colorbar.py::test_title_text_loc\"]",
  "environment_setup_commit": "de98877e3dc45de8dd441d008f23d88738dc015d",
  "_download_metadata": {
    "downloaded_at": "2025-10-07T21:23:30.801193",
    "dataset_name": "swe-bench",
    "split": "test",
    "downloader_version": "0.1.0"
  }
}